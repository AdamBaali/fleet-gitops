- name: CIS - Ensure 'Allow Cortana Above Lock' is set to 'Block'
  description: |-
    This policy setting determines whether or not the user can interact with Cortana using
    speech while the system is locked.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block.
    Above Lock\Allow Cortana Above Lock
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Windows Search\\AllowCortanaAboveLock' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Prevent enabling lock screen camera' is set to 'Enabled'
  description: |-
    Disables the lock screen camera toggle switch in PC Settings and prevents a camera from being invoked on the lock screen.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Control Panel\Personalization\Prevent enabling lock screen camera'
  query: SELECT 1 FROM registry where (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Personalization\NoLockScreenCamera' AND data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Prevent enabling lock screen slide show' is set to 'Enabled'
  description: |-
    Disables the lock screen slide show settings in PC Settings and prevents a slide show from playing on the lock screen.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Control Panel\Personalization\Prevent enabling lock screen slide show'
  query: SELECT 1 FROM registry where (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Personalization\NoLockScreenSlideshow' AND data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Apply UAC restrictions to local accounts on network logons' is set to 'Enabled'
  description: This setting controls whether local accounts can be used for remote administration via network logon (e.g., NET USE, connecting to C$, etc.). Local accounts are at high risk for credential theft when the same account and password is configured on multiple systems. Enabling this policy significantly reduces that risk.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\MS Security Guide\Apply UAC restrictions to local accounts on network logons'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\LocalAccountTokenFilterPolicy' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Configure SMB v1 client driver'' is set to ''Enabled: Disable driver (recommended)'''
  description: This setting configures the start type for the Server Message Block version 1 (SMBv1) client driver service (MRxSmb10), which is recommended to be disabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Disable driver (recommended)':
    'Computer Configuration\Policies\Administrative Templates\MS Security Guide\Configure SMB v1 client driver'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\MrxSmb10\Start' AND data = 4);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Configure SMB v1 server' is set to 'Disabled'
  description: This setting configures the server-side processing of the Server Message Block version 1 (SMBv1) protocol.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\MS Security Guide\Configure SMB v1 server'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters\SMB1' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable Structured Exception Handling Overwrite Protection (SEHOP)' is set to 'Enabled'
  description: Windows includes support for Structured Exception Handling Overwrite Protection (SEHOP). We recommend enabling this feature to improve the security profile of the computer.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\MS Security Guide\Enable Structured Exception Handling Overwrite Protection (SEHOP)'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\kernel\DisableExceptionChainValidation' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'WDigest Authentication' is set to 'Disabled'
  description: |-
    When WDigest authentication is enabled, Lsass.exe retains a copy of the user's plaintext password in memory, where it can be at risk of theft. If this setting is not configured, WDigest authentication is disabled in Windows 8.1 and in Windows Server 2012 R2; it is enabled by default in earlier versions of Windows and Windows Server.
    For more information about local accounts and credential theft, review the "Mitigating Pass-the-Hash (PtH) Attacks and Other Credential Theft Techniques" documents.
    For more information about UseLogonCredential, see Microsoft Knowledge Base article 2871997: Microsoft Security Advisory Update to improve credentials protection and management May 13, 2014.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\MS Security Guide\WDigest Authentication (disabling may require KB2871997)'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest\UseLogonCredential' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''MSS: (AutoAdminLogon) Enable Automatic Logon (not recommended)'' is set to ''Disabled'''
  description: This setting is separate from the Welcome screen feature in Windows XP and Windows Vista; if that feature is disabled, this setting is not disabled. If you configure a computer for automatic logon, anyone who can physically gain access to the computer can also gain access to everything that is on the computer, including any network or networks to which the computer is connected. Also, if you enable automatic logon, the password is stored in the registry in plaintext, and the specific registry key that stores this value is remotely readable by the Authenticated Users group.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (AutoAdminLogon) Enable Automatic Logon'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\AutoAdminLogon' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''MSS: (DisableIPSourceRouting IPv6) IP source routing protection level (protects against packet spoofing)'' is set to ''Enabled: Highest protection, source routing is completely disabled'''
  description: IP source routing is a mechanism that allows the sender to determine the IP route that a datagram should take through the network. It is recommended to configure this setting to Not Defined for enterprise environments and to Highest Protection for high security environments to completely disable source routing.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Highest protection, source routing is completely disabled':
    'Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (DisableIPSourceRouting) IP source routing protection level'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters\DisableIPSourceRouting' AND data = 2);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''MSS: (DisableIPSourceRouting) IP source routing protection level (protects against packet spoofing)'' is set to ''Enabled: Highest protection, source routing is completely disabled'''
  description: IP source routing is a mechanism that allows the sender to determine the IP route that a datagram should take through the network. It is recommended to configure this setting to Not Defined for enterprise environments and to Highest Protection for high security environments to completely disable source routing.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Highest protection, source routing is completely disabled':
    'Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (DisableIPSourceRouting) IP source routing protection level'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters\DisableIPSourceRouting' AND data = 2);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''MSS: (EnableICMPRedirect) Allow ICMP redirects to override OSPF generated routes'' is set to ''Disabled'''
  description: Internet Control Message Protocol (ICMP) redirects cause the IPv4 stack to plumb host routes. These routes override the Open Shortest Path First (OSPF) generated routes.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (EnableICMPRedirect) Allow ICMP redirects to override OSPF generated routes'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters\EnableICMPRedirect' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''MSS: (NoNameReleaseOnDemand) Allow the computer to ignore NetBIOS name release requests except from WINS servers'' is set to ''Enabled'''
  description: NetBIOS over TCP/IP is a network protocol that among other things provides a way to easily resolve NetBIOS names that are registered on Windows-based systems to the IP addresses that are configured on those systems. This setting determines whether the computer releases its NetBIOS name when it receives a name-release request.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (NoNameReleaseOnDemand) Allow the computer to ignore NetBIOS name release requests except from WINS servers'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\NetBT\\Parameters\NoNameReleaseOnDemand' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''MSS: (SafeDllSearchMode) Enable Safe DLL search mode (recommended)'' is set to ''Enabled'''
  description: |-
    The DLL search order can be configured to search for DLLs that are requested by running processes in one of two ways:
    - Search folders specified in the system path first, and then search the current working folder.
    - Search current working folder first, and then search the folders specified in the system path.
    When enabled, the registry value is set to 1. With a setting of 1, the system first searches the folders that are specified in the system path and then searches the current working folder.
    When disabled the registry value is set to 0 and the system first searches the current working folder and then searches the folders that are specified in the system path.
    Applications will be forced to search for DLLs in the system path first. For applications that require unique versions of these DLLs that are included with the application, this entry could cause performance or stability problems.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (SafeDllSearchMode) Enable Safe DLL search mode'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\SafeDllSearchMode' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''MSS: (ScreenSaverGracePeriod) The time in seconds before the screen saver grace period expires (0 recommended)'' is set to ''Enabled: 5 or fewer seconds'''
  description: Windows includes a grace period between when the screen saver is launched and when the console is actually locked automatically when screen saver locking is enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled: 5 or fewer seconds:
    'Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (ScreenSaverGracePeriod) The time in seconds before the screen saver grace period expires'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\ScreenSaverGracePeriod' AND data <= 5);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''MSS: (WarningLevel) Percentage threshold for the security event log at which the system will generate a warning'' is set to ''Enabled: 90% or less'''
  description: This setting can generate a security audit in the Security event log when the log reaches a user-defined threshold.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled: 90% or less:
    'Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (WarningLevel) Percentage threshold for the security event log at which the system will generate a warning'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\Security\WarningLevel' AND data <= 90);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Turn off multicast name resolution' is set to 'Enabled'
  description: |-
    LLMNR is a secondary name resolution protocol. With LLMNR, queries are sent using multicast over a local network link on a single subnet from a client computer to another client computer on the same subnet that also has LLMNR enabled. LLMNR does not require a DNS server or DNS client configuration, and provides name resolution in scenarios in which conventional DNS name resolution is not possible.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Network\DNS Client\Turn off multicast name resolution'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\DNSClient\EnableMulticast' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Prohibit installation and configuration of Network Bridge on your DNS domain network' is set to 'Enabled'
  description: |-
    You can use this procedure to control a user's ability to install and configure a Network Bridge..
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Network\Network Connections\Prohibit installation and configuration of Network Bridge on your DNS domain network'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Network Connections\NC_AllowNetBridge_NLA' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Prohibit use of Internet Connection Sharing on your DNS domain network' is set to 'Enabled'
  description: |-
    Although this "legacy" setting traditionally applied to the use of Internet Connection Sharing (ICS) in Windows 2000, Windows XP & Server 2003, this setting now freshly applies to the Mobile Hotspot feature in Windows 10 & Server 2016.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to On (recommended):
    'Computer Configuration\Policies\Administrative Templates\Network\Network Connections\Prohibit use of Internet Connection Sharing on your DNS domain network'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Network Connections\NC_ShowSharedAccessUI' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Require domain users to elevate when setting a network's location' is set to 'Enabled'
  description: |-
    This policy setting determines whether to require domain users to elevate when setting a network's location.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to On (recommended):
    'Computer Configuration\Policies\Administrative Templates\Network\Network Connections\Require domain users to elevate when setting a network's location'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Network Connections\NC_StdDomainUserSetLocation' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Hardened UNC Paths' is set to 'Enabled, with "Require Mutual Authentication", "Require Integrity", and “Require Privacy” set for all NETLOGON and SYSVOL shares'
  description: |-
    This policy setting configures secure access to UNC paths.
    The recommended state for this setting is: Enabled, with "Require Mutual
    Authentication", "Require Integrity", and “Require Privacy” set for
    all NETLOGON and SYSVOL shares.
    Note: If the environment is 100% managed by Intune these shares will not be available.
    An exception to this recommendation will be needed.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled with the following paths configured, at a minimum:
    \\*\NETLOGON RequireMutualAuthentication=1, RequireIntegrity=1,
    RequirePrivacy=1
    \\*\SYSVOL RequireMutualAuthentication=1, RequireIntegrity=1,
    RequirePrivacy=1
    Administrative Templates\Network\Network Provider\Hardened UNC Paths
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\NetworkProvider\\HardenedPaths\\RequirePrivacy' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Minimize the number of simultaneous connections to the Internet or a Windows Domain'' is set to ''Enabled: 3 = Prevent Wi-Fi when on Ethernet'''
  description: |-
    This policy setting prevents computers from establishing multiple simultaneous
    connections to either the Internet or to a Windows domain.
    The recommended state for this setting is: Enabled: 3 = Prevent Wi-Fi when on
    Ethernet.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled: 3 = Prevent Wi-Fi when on Ethernet.
    Administrative Templates\Network\Windows Connection Manager\Minimize the
    number of simultaneous connections to the Internet or a Windows Domain
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WcmSvc\\GroupPolicy\\fMinimizeConnections' AND data = '3';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Prohibit connection to non-domain networks when connected to domain authenticated network' is set to 'Enabled'
  description: |-
    This policy setting prevents computers from connecting to both a domain based network
    and a non-domain based network at the same time.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled.
    Administrative Templates\Network\Windows Connection Manager\Prohibit
    connection to non-domain networks when connected to domain authenticated
    network
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Network Connections\\NC_ProhibitNonDomainConnections' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Print Spooler to accept client connections' is set to 'Disabled'
  description: This policy setting controls whether the Print Spooler service will accept client connections.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\Printers\Allow Print Spooler to accept client connections'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT\Printers\RegisterSpoolerRemoteRpcEndPoint' AND data = 2);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Configure Redirection Guard: Redirection Guard Options'' is set to ''Enabled: Redirection Guard Enabled'''
  description: This policy setting determines whether Redirection Guard is enabled for the print spooler. Redirection Guard can prevent file redirections from being used within the print spooler.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Redirection Guard Enabled':
    'Computer Configuration\Policies\Administrative Templates\Printers\Configure Redirection Guard'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Printers\RedirectionGuardPolicy' AND (data = 1));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Configure RPC connection settings: Protocol to use for outgoing RPC connections'' is set to ''Enabled: RPC over TCP'''
  description: This policy setting controls which protocol and protocol settings to use for outgoing Remote Procedure Call (RPC) connections to a remote print spooler.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: RPC over TCP':
    'Computer Configuration\Policies\Administrative Templates\Printers\Configure RPC connection settings: Protocol to use for outgoing RPC connections'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Printers\RPC\RpcUseNamedPipeProtocol' AND (data = 0));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Configure RPC connection settings: Use authentication for outgoing RPC connections'' is set to ''Enabled: Default'''
  description: This policy setting controls which protocol and protocol settings to use for outgoing Remote Procedure Call (RPC) connections to a remote print spooler.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: RPC over TCP':
    'Computer Configuration\Policies\Administrative Templates\Printers\Configure RPC connection settings: Use authentication for outgoing RPC connections'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Printers\RPC\RpcAuthentication' AND (data = 0));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Configure RPC listener settings: Authentication protocol to use for incoming RPC connections:'' is set to ''Enabled: Negotiate'' or higher'
  description: This policy setting controls which protocols incoming Remote Procedure Call (RPC) connections to the print spooler are allowed to use.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Negotiate':
    'Computer Configuration\Policies\Administrative Templates\Printers\Configure RPC listener settings: Configure protocol options for incoming RPC connections'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Printers\RPC\ForceKerberosForRpc' AND (data = 0));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Configure RPC listener settings: Protocols to allow for incoming RPC connections'' is set to ''Enabled: RPC over TCP'''
  description: This policy setting controls which protocols incoming Remote Procedure Call (RPC) connections to the print spooler are allowed to use.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: RPC over TCP':
    'Computer Configuration\Policies\Administrative Templates\Printers\Configure RPC listener settings: Configure protocol options for incoming RPC connections'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Printers\RPC\RpcProtocols' AND (data = 5));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Configure RPC over TCP port: RPC over TCP port:'' is set to ''Enabled: 0'''
  description: |-
    This policy setting controls which port is used for RPC over TCP for incoming
    connections to the print spooler and outgoing connections to remote print spoolers.
    The recommended state for this setting is: Enabled: 0.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to
    Enabled: 0:
    Administrative Templates\Printers\Configure RPC over TCP port: RPC over TCP
    port
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Rpc\\TcpPort' AND data = '0';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Limits print driver installation to Administrators' is set to 'Enabled'
  description: This policy setting controls whether users that aren't Administrators can install print drivers on the system.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled.
    'Computer Configuration\Policies\Administrative Templates\MS Security Guide\Limits print driver installation to Administrators'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Printers\\PointAndPrint\RestrictDriverInstallationToAdministrators' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Manage processing of Queue-specific files: Manage processing of Queue-Specific files'' is set to ''Enabled: Limit Queue-specific files to Color profiles'''
  description: This policy setting manages how queue-specific files are processed during printer installation. At printer installation time, a vendor-supplied installation application can specify a set of files, of any type, to be associated with a particular print queue. The files are downloaded to each client that connects to the print server.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Limit Queue-specific files to Color profiles':
    'Computer Configuration\Policies\Administrative Templates\Printers\Manage processing of Queue-specific files'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Printers\CopyFilesPolicy' AND (data = 1));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Point and Print Restrictions: When installing drivers for a new connection'' is set to ''Enabled: Show warning and elevation prompt'''
  description: This policy setting controls whether computers will show a warning and a security elevation prompt when users create a new printer connection using Point and Print.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Show warning and elevation prompt':
    'Computer Configuration\Policies\Administrative Templates\Printers\Point and Print Restrictions: When installing drivers for a new connection'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT\Printers\PointAndPrint\NoWarningNoElevationOnInstall' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Point and Print Restrictions: When updating drivers for an existing connection'' is set to ''Enabled: Show warning and elevation prompt'''
  description: This policy setting controls whether computers will show a warning and a security elevation prompt when users are updating drivers for an existing connection using Point and Print.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Show warning and elevation prompt':
    'Computer Configuration\Policies\Administrative Templates\Printers\Point and Print Restrictions: When updating drivers for an existing connection'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT\Printers\PointAndPrint\UpdatePromptSettings' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Turn off toast notifications on the lock screen (User)' is set to 'Enabled'
  description: |-
    This policy setting turns off toast notifications on the lock screen.
    The recommended state for this setting is Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'User Configuration\Policies\Administrative Templates\Start Menu and Taskbar\Notifications\Turn off toast notifications on the lock screen'
  query: SELECT 1 FROM registry WHERE path LIKE 'HKEY_USERS\%\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\PushNotifications\NoToastApplicationNotificationOnLockScreen' AND data = 1;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Include command line in process creation events' is set to 'Enabled'
  description: This policy setting controls whether the process creation command line text is logged in security audit events when a new process has been created.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Audit Process Creation\Include command line in process creation events'
  query: SELECT 1 FROM REGISTRY WHERE (PATH = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Audit\ProcessCreationIncludeCmdLine_Enabled' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Encryption Oracle Remediation'' is set to ''Enabled: Force Updated Clients'''
  description: Some versions of the CredSSP protocol that is used by some applications (such as Remote Desktop Connection) are vulnerable to an encryption oracle attack against the client. This policy controls compatibility with vulnerable clients and servers and allows you to set the level of protection desired for the encryption oracle vulnerability.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Force Updated Clients':
    'Computer Configuration\Policies\Administrative Templates\System\Credentials Delegation\Encryption Oracle Remediation'
  query: SELECT 1 FROM REGISTRY WHERE (PATH = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\CredSSP\\Parameters\AllowEncryptionOracle' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Remote host allows delegation of nonexportable credentials' is set to 'Enabled'
  description: Remote host allows delegation of non-exportable credentials. When using credential delegation, devices provide an exportable version of credentials to the remote host. This exposes users to the risk of credential theft from attackers on the remote host. The Restricted Admin Mode and Windows Defender Remote Credential Guard features are two options to help protect against this risk.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Credentials Delegation\Remote host allows delegation of non-exportable credentials'
  query: SELECT 1 FROM REGISTRY WHERE (PATH = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredentialsDelegation\AllowProtectedCreds' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Prevent device metadata retrieval from the Internet' is set to 'Enabled'
  description: This policy setting allows you to prevent Windows from retrieving device metadata from the Internet.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Device Installation\Prevent device metadata retrieval from the Internet'
  query: SELECT 1 FROM REGISTRY WHERE (PATH = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Device Metadata\PreventDeviceMetadataFromNetwork' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Boot-Start Driver Initialization Policy'' is set to ''Enabled: Good, unknown and bad but critical'''
  description: 'This policy setting allows you to specify which boot-start drivers are initialized based on a classification determined by an Early Launch Antimalware boot-start driver. The Early Launch Antimalware boot-start driver can return the following classifications for each boot-start driver:'
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled: 'Good, unknown and bad but critical':
    'Computer Configuration\Policies\Administrative Templates\System\Early Launch Antimalware\Boot-Start Driver Initialization Policy'
  query: SELECT 1 FROM REGISTRY WHERE (PATH = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Policies\\EarlyLaunch\DriverLoadPolicy' AND data = 3);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Continue experiences on this device' is set to 'Disabled'
  description: This policy setting determines whether the Windows device is allowed to participate in cross-device experiences (continue experiences).
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\System\Group Policy\Continue experiences on this device'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\EnableCdp' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Turn off background refresh of Group Policy' is set to 'Disabled'
  description: |-
    This policy setting prevents Group Policy from being updated while the computer is in use.
    This policy setting applies to Group Policy for computers, users and Domain Controllers.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\System\Group Policy\Turn off background refresh of Group Policy'
  query: |-
    -- The registry key is not present when policy is disabled, so query below is returning 1 when policy is disabled and registry value does not exist. It also return 1 in case policy is enabled and its registry value is 1
    SELECT 1 WHERE (
    NOT EXISTS ( SELECT 1 FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System' AND name = 'DisableBkGndGroupPolicy' )
    ) OR (
    NOT EXISTS ( SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DisableBkGndGroupPolicy' AND data = 1 )
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Turn off downloading of print drivers over HTTP' is set to 'Enabled'
  description: This policy setting controls whether the computer can download print driver packages over HTTP. To set up HTTP printing, printer drivers that are not available in the standard operating system installation might need to be downloaded over HTTP.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off downloading of print drivers over HTTP'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Printers\DisableWebPnPDownload' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Turn off Internet download for Web publishing and online ordering wizards' is set to 'Enabled'
  description: This policy setting controls whether Windows will download a list of providers for the Web publishing and online ordering wizards.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off Internet download for Web publishing and online ordering wizards'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\NoWebServices' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Block user from showing account details on sign-in' is set to 'Enabled'
  description: This policy prevents the user from showing account details (email address or user name) on the sign-in screen.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Logon\Block user from showing account details on sign-in'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\BlockUserFromShowingAccountDetailsOnSignin' AND data =  1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Do not display network selection UI' is set to 'Enabled'
  description: This policy setting allows you to control whether anyone can interact with available networks UI on the logon screen.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Logon\Do not display network selection UI'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\DontDisplayNetworkSelectionUI' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Do not enumerate connected users on domain-joined computers' is set to 'Enabled'
  description: This policy setting prevents connected users from being enumerated on domain-joined computers.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Logon\Do not enumerate connected users on domain-joined computers'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\DontEnumerateConnectedUsers' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enumerate local users on domain-joined computers' is set to 'Disabled'
  description: This policy setting allows local users to be enumerated on domain-joined computers.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\System\Logon\Enumerate local users on domain-joined computers'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\EnumerateLocalUsers' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Turn off app notifications on the lock screen' is set to 'Enabled'
  description: This policy setting allows you to prevent app notifications from appearing on the lock screen.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Logon\Turn off app notifications on the lock screen'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\DisableLockScreenAppNotifications' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Turn off picture password sign-in' is set to 'Enabled'
  description: This policy setting allows you to control whether a domain user can sign in using a picture password.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Logon\Turn off picture password sign-in'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\BlockDomainPicturePassword' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Turn on convenience PIN sign-in' is set to 'Disabled'
  description: This policy setting allows you to control whether a domain user can sign in using a convenience PIN. In Windows 10, convenience PIN was replaced with Passport, which has stronger security properties. To configure Passport for domain users, use the policies under Computer Configuration\Administrative Templates\Windows Components\Microsoft Passport for Work.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\System\Logon\Turn on convenience PIN sign-in'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\AllowDomainPINLogon' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Require a password when a computer wakes (on battery)' is set to 'Enabled'
  description: Specifies whether or not the user is prompted for a password when the system resumes from sleep.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Power Management\Sleep Settings\Require a password when a computer wakes (on battery)'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Power\\PowerSettings\\0e796bdb-100d-47d6-a2d5-f7d2daa51f51\DCSettingIndex' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Require a password when a computer wakes (plugged in)' is set to 'Enabled'
  description: Specifies whether or not the user is prompted for a password when the system resumes from sleep.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Power Management\Sleep Settings\Require a password when a computer wakes (plugged in)'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Power\\PowerSettings\\0e796bdb-100d-47d6-a2d5-f7d2daa51f51\ACSettingIndex' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Configure Offer Remote Assistance' is set to 'Disabled'
  description: This policy setting allows you to turn on or turn off Offer (Unsolicited) Remote Assistance on this computer. Help desk and support personnel will not be able to proactively offer assistance, although they can still respond to user assistance requests.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\System\Remote Assistance\Configure Offer Remote Assistance'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\fAllowUnsolicited' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Configure Solicited Remote Assistance' is set to 'Disabled'
  description: This policy setting allows you to turn on or turn off Solicited (Ask for) Remote Assistance on this computer.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\System\Remote Assistance\Configure Solicited Remote Assistance'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\fAllowToGetHelp' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable RPC Endpoint Mapper Client Authentication' is set to 'Enabled'
  description: This policy setting controls whether RPC clients authenticate with the Endpoint Mapper Service when the call they are making contains authentication information. The Endpoint Mapper Service on computers running Windows NT4 (all service packs) cannot process authentication information supplied in this manner. This policy setting can cause a specific issue with 1-way forest trusts if it is applied to the trusting domain DCs (see Microsoft KB3073942), so we do not recommend applying it to Domain Controllers.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Remote Procedure Call\Enable RPC Endpoint Mapper Client Authentication'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Rpc\EnableAuthEpResolution' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Restrict Unauthenticated RPC clients'' is set to ''Enabled: Authenticated'''
  description: |-
    This policy setting controls how the RPC server runtime handles unauthenticated RPC clients connecting to RPC servers.
    This policy setting impacts all RPC applications. In a domain environment this policy setting should be used with caution as it can impact a wide range of functionality including group policy processing itself. Reverting a change to this policy setting can require manual intervention on each affected machine. This policy setting should never be applied to a Domain Controller.
    A client will be considered an authenticated client if it uses a named pipe to communicate with the server or if it uses RPC Security. RPC Interfaces that have specifically requested to be accessible by unauthenticated clients may be exempt from this restriction, depending on the selected value for this policy setting.
    -- "None" allows all RPC clients to connect to RPC Servers running on the machine on which the policy setting is applied.
    -- "Authenticated" allows only authenticated RPC Clients (per the definition above) to connect to RPC Servers running on the machine on which the policy setting is applied. Exemptions are granted to interfaces that have requested them.
    -- "Authenticated without exceptions" allows only authenticated RPC Clients (per the definition above) to connect to RPC Servers running on the machine on which the policy setting is applied. No exceptions are allowed. This value has the potential to cause serious problems and is not recommended.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Authenticated':
    'Computer Configuration\Policies\Administrative Templates\System\Remote Procedure Call\Restrict Unauthenticated RPC clients'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Rpc\RestrictRemoteClients' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable Windows NTP Client' is set to 'Enabled'
  description: This policy setting specifies whether the Windows NTP Client is enabled. Enabling the Windows NTP Client allows your computer to synchronize its computer clock with other NTP servers. You might want to disable this service if you decide to use a third-party time provider.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\System\Windows Time Service\Time Providers\Enable Windows NTP Client'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\Microsoft\\W32Time\\TimeProviders\\NtpClient\Enabled' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable Windows NTP Server' is set to 'Disabled'
  description: This policy setting allows you to specify whether the Windows NTP Server is enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\System\Windows Time Service\Time Providers\Enable Windows NTP Server'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\Software\\Policies\\Microsoft\\W32Time\\TimeProviders\\NtpServer' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Microsoft accounts to be optional' is set to 'Enabled'
  description: |-
    This policy setting lets you control whether Microsoft accounts are optional for Windows Store
    apps that require an account to sign in. This policy only affects Windows Store apps that support it.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\App runtime\Allow Microsoft accounts to be optional'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\MSAOptional' AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Do not preserve zone information in file attachments (User)' is set to 'Disabled'
  description: This policy setting allows you to manage whether Windows marks file attachments with information about their zone of origin (such as restricted, Internet, intranet, local). This requires NTFS in order to function correctly, and will fail without notice on FAT32. By not preserving the zone information, Windows cannot make proper risk assessments.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'User Configuration\Policies\Administrative Templates\Windows Components\Attachment Manager\Do not preserve zone information in file attachments'
  query: SELECT 1 FROM registry WHERE (path LIKE 'HKEY_USERS\%\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy Objects\%\Software\Microsoft\Windows\CurrentVersion\Policies\Attachments\SaveZoneInformation' and data = 2);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Notify antivirus programs when opening attachments (User)' is set to 'Enabled'
  description: This policy setting manages the behavior for notifying registered antivirus programs. If multiple programs are registered, they will all be notified.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'User Configuration\Policies\Administrative Templates\Windows Components\Attachment Manager\Notify antivirus programs when opening attachments'
  query: SELECT 1 FROM registry WHERE (path LIKE 'HKEY_USERS\%\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy Objects\%\Software\Microsoft\Windows\CurrentVersion\Policies\Attachments\ScanWithAntiVirus' AND data = 3);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Disallow Autoplay for non-volume devices' is set to 'Enabled'
  description: This policy setting disallows AutoPlay for MTP devices like cameras or phones.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\AutoPlay Policies\Disallow Autoplay for non-volume devices'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Explorer\\NoAutoplayfornonVolume' AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Set the default behavior for AutoRun'' is set to ''Enabled: Do not execute any autorun commands'''
  description: |-
    This policy setting sets the default behavior for Autorun commands. Autorun commands are
    generally stored in autorun.inf files. They often launch the installation program or other routines.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Enabled Do not execute any autorun commands':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\AutoPlay Policies\Set the default behavior for AutoRun'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoAutorun' AND data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Turn off Autoplay'' is set to ''Enabled: All drives'''
  description: |-
    This policy setting sets the default behavior for Autorun commands. Autorun commands are
    generally stored in autorun.inf files. They often launch the installation program or other routines.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Enabled All drives':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\AutoPlay Policies\Turn off Autoplay'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\NoDriveTypeAutoRun' AND data == 255);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Do not display the password reveal button' is set to 'Enabled'
  description: This policy setting allows you to configure the display of the password reveal button in password entry user experiences.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Credential User Interface\Do not display the password reveal button'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\CredUI\DisablePasswordReveal' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enumerate administrator accounts on elevation' is set to 'Disabled'
  description: This policy setting controls whether administrator accounts are displayed when a user attempts to elevate a running application.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Credential User Interface\Enumerate administrator accounts on elevation'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\CredUI\EnumerateAdministrators' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Prevent the use of security questions for local accounts' is set to 'Enabled'
  description: This policy setting controls whether security questions can be used to reset local account passwords. The security question feature does not apply to domain accounts, only local accounts on the workstation.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Credential User Interface\Prevent the use of security questions for local accounts'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\NoLocalPasswordResetQuestions' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable App Installer Experimental Features' is set to 'Disabled'
  description: This policy setting controls whether users can enable experimental features in the Windows Package Manager.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Desktop App Installer\Enable App Installer Experimental Features'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\AppInstaller\\EnableExperimentalFeatures' AND (data = 0));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable App Installer Hash Override' is set to 'Disabled'
  description: This policy setting controls whether or not users can override the SHA256 security validation in the Windows Package Manager settings.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Desktop App Installer\Enable App Installer Hash Override'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\AppInstaller\\EnableHashOverride' AND (data = 0));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable App Installer ms-appinstaller protocol' is set to 'Disabled'
  description: This policy setting controls whether users can install packages from a website that is using the ms-appinstaller protocol. The ms-appinstaller protocol allows users to install an application by clicking a link on a website.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Desktop App Installer\Enable App Installer ms-appinstaller protocol'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\AppInstaller\\EnableMSAppInstallerProtocol' AND (data = 0));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Control Event Log behavior when the log file reaches its maximum size' is set to 'Disabled'
  description: This policy setting controls Event Log behavior when the log file reaches its maximum size.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Event Log Service\Application\Control Event Log behavior when the log file reaches its maximum size'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\Policies\\Microsoft\\Windows\\EventLog\\Application\Retention' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Specify the maximum log file size (KB)'' is set to ''Enabled: 32,768 or greater'''
  description: This policy setting specifies the maximum size of the log file in kilobytes. The maximum log file size can be configured between 1 megabyte (1,024 kilobytes) and 4 terabytes (4,194,240 kilobytes) in kilobyte increments.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled: 32,768 or greater:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Event Log Service\Application\Specify the maximum log file size (KB)'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\EventLog\\Application\\MaxSize' AND data >= 32768 );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Specify the maximum log file size (KB)'' is set to ''Enabled: 196,608 or greater'''
  description: This policy setting specifies the maximum size of the log file in kilobytes. The maximum log file size can be configured between 1 megabyte (1,024 kilobytes) and 4 terabytes (4,194,240 kilobytes) in kilobyte increments.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled: 196,608 or greater:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Event Log Service\Security\Specify the maximum log file size (KB)'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\EventLog\\Security\MaxSize' AND data >= 196608 );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Configure Windows Defender SmartScreen'' is set to ''Enabled: Warn and prevent bypass'''
  description: This policy setting allows you to manage the behavior of Windows Defender SmartScreen. Windows Defender SmartScreen helps keep PCs safer by warning users before running unrecognized programs downloaded from the Internet. Some information is sent to Microsoft about files and programs run on PCs with this feature enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Warn and prevent bypass':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Defender SmartScreen\Explorer\Configure Windows Defender SmartScreen'
  query: |-
    SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\EnableSmartScreen' AND data = 1)
    AND EXISTS (
    SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\ShellSmartScreenLevel' AND data = 'Block')
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Turn off Data Execution Prevention for Explorer' is set to 'Disabled'
  description: Disabling Data Execution Prevention can allow certain legacy plug-in applications to function without terminating Explorer.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\File Explorer\Turn off Data Execution Prevention for Explorer'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Explorer\NoDataExecutionPrevention' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Turn off heap termination on corruption' is set to 'Disabled'
  description: Without heap termination on corruption, legacy plug-in applications may continue to function when a File Explorer session has become corrupt. Ensuring that heap termination on corruption is active will prevent this.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\File Explorer\Turn off heap termination on corruption'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Explorer\NoHeapTerminationOnCorruption' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Turn off shell protocol protected mode' is set to 'Disabled'
  description: This policy setting allows you to configure the amount of functionality that the shell protocol can have. When using the full functionality of this protocol, applications can open folders and launch files. The protected mode reduces the functionality of this protocol allowing applications to only open a limited set of folders. Applications are not able to open files with this protocol when it is in the protected mode. It is recommended to leave this protocol in the protected mode to increase the security of Windows.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\File Explorer\Turn off shell protocol protected mode'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\PreXPSP2ShellProtocolBehavior' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Block all consumer Microsoft account user authentication' is set to 'Enabled'
  description: This setting determines whether applications and services on the device can utilize new consumer Microsoft account authentication via the Windows OnlineID and WebAccountManager APIs.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Microsoft accounts\Block all consumer Microsoft account user authentication'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\MicrosoftAccount\\DisableUserAuth' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Configure local setting override for reporting to Microsoft MAPS' is set to 'Disabled'
  description: This policy setting configures a local override for the configuration to join Microsoft Active Protection Service, which Microsoft renamed to Windows Defender Antivirus Cloud Protection Service and then Microsoft Defender Antivirus Cloud Protection Service.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Microsoft Defender Antivirus\MAPS\Configure local setting override for reporting to Microsoft MAPS'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Spynet\\LocalSettingOverrideSpynetReporting' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Prevent users from sharing files within their profile. (User)' is set to 'Enabled'
  description: This policy setting determines whether users can share files within their profile. By default, users are allowed to share files within their profile to other users on their network after an administrator opts in the computer. An administrator can opt in the computer by using the sharing wizard to share a file within their profile.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'User Configuration\Policies\Administrative Templates\Windows Components\Network Sharing\Prevent users from sharing files within their profile'
  query: SELECT 1 FROM registry WHERE (path LIKE 'HKEY_USERS\%\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoInplaceSharing' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Do not allow passwords to be saved' is set to 'Enabled'
  description: |-
    This policy setting helps prevent Remote Desktop clients from saving passwords on a computer.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Remote Desktop Services\Remote Desktop Connection Client\Do not allow passwords to be saved'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\\DisablePasswordSaving' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Do not allow drive redirection' is set to 'Enabled'
  description: This policy setting prevents users from sharing the local drives on their client computers to Remote Desktop Servers that they access.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Remote Desktop Services\Remote Desktop Session Host\Device and Resource Redirection\Do not allow drive redirection'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\\fDisableCdm' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Always prompt for password upon connection' is set to 'Enabled'
  description: This policy setting specifies whether Remote Desktop Services always prompts the client computer for a password upon connection.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Remote Desktop Services\Remote Desktop Session Host\Security\Always prompt for password upon connection'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\\fPromptForPassword' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Require secure RPC communication' is set to 'Enabled'
  description: This policy setting allows you to specify whether Remote Desktop Services requires secure Remote Procedure Call (RPC) communication with all clients or allows unsecured communication.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Remote Desktop Services\Remote Desktop Session Host\Security\Require secure RPC communication'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\\fEncryptRPCTraffic' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Require use of specific security layer for remote (RDP) connections'' is set to ''Enabled: SSL'''
  description: This policy setting specifies whether to require the use of a specific security layer to secure communications between clients and RD Session Host servers during Remote Desktop Protocol (RDP) connections.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: SSL':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Remote Desktop Services\Remote Desktop Session Host\Security\Require use of specific security layer for remote (RDP) connections'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\\SecurityLayer' AND data = 2);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Require user authentication for remote connections by using Network Level Authentication' is set to 'Enabled'
  description: This policy setting allows you to specify whether to require user authentication for remote connections to the RD Session Host server by using Network Level Authentication.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Remote Desktop Services\Remote Desktop Session Host\Security\Require user authentication for remote connections by using Network Level Authentication'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\\UserAuthentication' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Set client connection encryption level'' is set to ''Enabled: High Level'''
  description: |-
    This policy setting specifies whether to require the use of a specific encryption level to secure communications between client computers and RD Session Host servers during Remote Desktop Protocol (RDP) connections.
    This policy only applies when you are using native RDP encryption.
    However, native RDP encryption (as opposed to SSL encryption) is not recommended.
    This policy does not apply to SSL encryption.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled', then 'High Level':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Remote Desktop Services\Remote Desktop Session Host\Security\Set client connection encryption level'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\\MinEncryptionLevel' AND data = 3);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Do not delete temp folders upon exit' is set to 'Disabled'
  description: This policy setting specifies whether Remote Desktop Services retains a user's per-session temporary folders at logoff.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Remote Desktop Services\Remote Desktop Session Host\Temporary Folders\Do not delete temp folders upon exit'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\\DeleteTempDirsOnExit' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Prevent downloading of enclosures' is set to 'Enabled'
  description: This policy setting prevents the user from having enclosures (file attachments) downloaded from an RSS feed to the user's computer.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\RSS Feeds\Prevent downloading of enclosures'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Internet Explorer\\Feeds\\DisableEnclosureDownload' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Turn off the offer to update to the latest version of Windows' is set to 'Enabled'
  description: Enables or disables the Microsoft Store offer to update to the latest version of Windows.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Store\Turn off the offer to update to the latest version of Windows'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\WindowsStore\DisableOSUpgrade' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable MPR notifications for the system' is set to 'Disabled'
  description: |-
    This policy setting controls whether winlogon sends Multiple Provider Router (MPR)
    notifications. MPR handles communication between the Windows operating system and
    the installed network providers. MPR checks the registry to determine which providers
    are installed on the system and the order they are cycled through.
    The recommended state for this setting is: Disabled.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Disabled:
    Administrative Templates\Windows Components\Windows Logon Options\Enable MPR
    notifications for the system
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\EnableMPRNotifications' AND data = '0';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Sign-in and lock last interactive user automatically after a restart' is set to 'Disabled'
  description: This policy setting controls whether a device will automatically sign-in the last interactive user after Windows Update restarts the system.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Logon Options\Sign-in and lock last interactive user automatically after a restart'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\System\DisableAutomaticRestartSignOn' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Basic authentication' is set to 'Disabled'
  description: This policy setting allows you to manage whether the Windows Remote Management (WinRM) client uses Basic authentication.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Remote Management (WinRM)\WinRM Client\Allow Basic authentication'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WinRM\\Client\\AllowBasic' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow unencrypted traffic' is set to 'Disabled'
  description: This policy setting allows you to manage whether the Windows Remote Management (WinRM) client sends and receives unencrypted messages over the network.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Remote Management (WinRM)\WinRM Client\Allow unencrypted traffic'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WinRM\\Client\\AllowUnencryptedTraffic' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Disallow Digest authentication' is set to 'Enabled'
  description: This policy setting allows you to manage whether the Windows Remote Management (WinRM) client will not use Digest authentication.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Remote Management (WinRM)\WinRM Client\Disallow Digest authentication'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WinRM\\Client\\AllowDigest' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Disallow WinRM from storing RunAs credentials' is set to 'Enabled'
  description: This policy setting allows you to manage whether the Windows Remote Management (WinRM) service will allow RunAs credentials to be stored for any plug-ins.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Remote Management (WinRM)\WinRM Service\Disallow WinRM from storing RunAs credentials'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WinRM\\Service\\DisableRunAs' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Account Logon Audit Credential Validation' is set to 'Success and Failure'
  description: |-
    Creates audit events whenever an attempt is made to authenticate, whether it is successful or not.
    This makes it easier to investigate a future security incident if required.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to Success and Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Logon\Audit Credential Validation'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input =
    "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/AccountLogon_AuditCredentialValidation</LocURI></Target></Item></Get></SyncBody>"
    AND mdm_command_output = "3";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Account Logon Logoff Audit Account Lockout' is set to include 'Failure'
  description: |-
    This subcategory reports when a user's account is locked out as a result of too many failed logon attempts. Events for this subcategory include:
    - 4625: An account failed to log on.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to include Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Account Lockout'
  query: SELECT 1 FROM cis_audit where item = "17.5.1" AND (regex_match(value,".*(?=.*Failure).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Account Logon Logoff Audit Group Membership' is set to include 'Success'
  description: This policy allows you to audit the group membership information in the user's logon token. Events in this subcategory are generated on the computer on which a logon session is created. For an interactive logon, the security audit event is generated on the computer that the user logged on to. For a network logon, such as accessing a shared folder on the network, the security audit event is generated on the computer hosting the resource.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to include Success:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Group Membership'
  query: SELECT 1 FROM cis_audit where item = "17.5.2" AND (regex_match(value,".*(?=.*Success).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Account Logon Logoff Audit Logoff' is set to include 'Success'
  description: |-
    This subcategory reports when a user logs off from the system. These events occur on the accessed computer. For interactive logons, the generation of these events occurs on the computer that is logged on to. If a network logon takes place to access a share, these events generate on the computer that hosts the accessed resource. If you configure this setting to No auditing, it is difficult or impossible to determine which user has accessed or attempted to access organization computers. Events for this subcategory include:
    - 4634: An account was logged off.
    - 4647: User initiated logoff.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to include Success:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Logoff'
  query: SELECT 1 FROM cis_audit where item = "17.5.3" AND (regex_match(value,".*(?=.*Success).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Account Logon Logoff Audit Logon' is set to 'Success and Failure'
  description: |-
    This subcategory reports when a user attempts to log on to the system. These events occur on the accessed computer. For interactive logons, the generation of these events occurs on the computer that is logged on to. If a network logon takes place to access a share, these events generate on the computer that hosts the accessed resource. If you configure this setting to No auditing, it is difficult or impossible to determine which user has accessed or attempted to access organization computers. Events for this subcategory include:
    - 4624: An account was successfully logged on.
    - 4625: An account failed to log on.
    - 4648: A logon was attempted using explicit credentials.
    - 4675: SIDs were filtered.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Success and Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Logon'
  query: SELECT 1 FROM cis_audit where item = "17.5.4" AND (regex_match(value,".*(?=.*Success)(?=.*Failure).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Account Management Audit Application Group Management' is set to 'Success and Failure'
  description: |-
    Creates audit events whenever an application group is changed, e.g. by adding members.
    This makes it easier to investigate a future security incident if required.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to Success and Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Application Group Management'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input =
    "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/AccountManagement_AuditApplicationGroupManagement</LocURI></Target></Item></Get></SyncBody>"
    AND mdm_command_output = "3";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Audit Authentication Policy Change' is set to include 'Success'
  description: |-
    This subcategory reports changes in authentication policy. Events for this subcategory include:
    -  4706: A new trust was created to a domain.
    -  4707: A trust to a domain was removed.
    -  4713: Kerberos policy was changed.
    -  4716: Trusted domain information was modified.
    -  4717: System security access was granted to an account.
    -  4718: System security access was removed from an account.
    -  4739: Domain Policy was changed.
    -  4864: A namespace collision was detected.
    -  4865: A trusted forest information entry was added.
    -  4866: A trusted forest information entry was removed.
    -  4867: A trusted forest information entry was modified.
    The recommended state for this setting is to include: Success.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to include Success:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Authentication Policy Change'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/PolicyChange_AuditAuthenticationPolicyChange</LocURI></Target></Item></Get></SyncBody>"
    AND (mdm_command_output = 1 OR mdm_command_output = 3);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Audit Authorization Policy Change' is set to include 'Success'
  description: |-
    This subcategory reports changes in authorization policy. Events for this subcategory include:
    -  4704: A user right was assigned.
    -  4705: A user right was removed.
    -  4706: A new trust was created to a domain.
    -  4707: A trust to a domain was removed.
    -  4714: Encrypted data recovery policy was changed.
    The recommended state for this setting is to include: Success.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to include Success:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Authorization Policy Change'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/PolicyChange_AuditAuthorizationPolicyChange</LocURI></Target></Item></Get></SyncBody>"
    AND (mdm_command_output = 1 OR mdm_command_output = 3);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Audit Changes to Audit Policy' is set to include 'Success'
  description: |-
    This subcategory reports changes in audit policy including SACL changes. Events for this subcategory include:
    -  4715: The audit policy (SACL) on an object was changed.
    -  4719: System audit policy was changed.
    -  4902: The Per-user audit policy table was created.
    -  4904: An attempt was made to register a security event source.
    -  4905: An attempt was made to unregister a security event source.
    -  4906: The CrashOnAuditFail value has changed.
    -  4907: Auditing settings on object were changed.
    -  4908: Special Groups Logon table modified.
    -  4912: Per User Audit Policy was changed.
    The recommended state for this setting is to include: Success.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to include Success:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Audit Policy Change'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/PolicyChange_AuditPolicyChange</LocURI></Target></Item></Get></SyncBody>"
    AND (mdm_command_output = 1 OR mdm_command_output = 3);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Audit File Share Access' is set to 'Success and Failure'
  description: 'This policy setting allows you to audit attempts to access a shared folder. The recommended state for this setting is: Success and Failure.'
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to Success and Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Object Access\Audit File Share'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/ObjectAccess_AuditFileShare</LocURI></Target></Item></Get></SyncBody>"
    AND mdm_command_output = 3;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Audit Other Logon Logoff Events' is set to 'Success and Failure'
  description: |-
    This subcategory reports other logon/logoff-related events, such as Remote Desktop Services session disconnects and reconnects, using RunAs to run processes under a different account, and locking and unlocking a workstation. Events for this subcategory include:
    - 4649: A replay attack was detected.
    - 4778: A session was reconnected to a Window Station.
    - 4779: A session was disconnected from a Window Station.
    - 4800: The workstation was locked.
    - 4801: The workstation was unlocked.
    - 4802: The screen saver was invoked.
    - 4803: The screen saver was dismissed.
    - 5378: The requested credentials delegation was disallowed by policy.
    - 5632: A request was made to authenticate to a wireless network.
    - 5633: A request was made to authenticate to a wired network.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Success and Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Other Logon/Logoff Events'
  query: SELECT 1 FROM cis_audit where item = "17.5.5" AND (regex_match(value,".*(?=.*Success)(?=.*Failure).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Audit Security Group Management' is set to include 'Success'
  description: |-
    Creates audit events whenever a security group is changed, e.g. by adding members.
    This makes it easier to investigate a future security incident if required.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Success and Failure' or 'Success':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Security Group Management'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input =
    "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/AccountManagement_AuditSecurityGroupManagement</LocURI></Target></Item></Get></SyncBody>"
    AND (mdm_command_output = "1" OR mdm_command_output = "3");
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Audit Security System Extension' is set to include 'Success'
  description: |-
    This subcategory reports the loading of extension code such as authentication packages by the security subsystem. Events for this subcategory include:
    -  4610: An authentication package has been loaded by the Local Security Authority.
    -  4611: A trusted logon process has been registered with the Local Security Authority.
    -  4614: A notification package has been loaded by the Security Account Manager.
    -  4622: A security package has been loaded by the Local Security Authority.
    -  4697: A service was installed in the system.
    The recommended state for this setting is to include: Success.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to include Success:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit Security System Extension'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/System_AuditSecuritySystemExtension</LocURI></Target></Item></Get></SyncBody>"
    AND (mdm_command_output = 3 OR mdm_command_output = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Audit Special Logon' is set to include 'Success'
  description: |-
    This subcategory reports when a special logon is used. A special logon is a logon that has administrator-equivalent privileges and can be used to elevate a process to a higher level. Events for this subcategory include:
    - 4964 : Special groups have been assigned to a new logon.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to include Success:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Special Logon'
  query: SELECT 1 FROM cis_audit where item = "17.5.6" AND (regex_match(value,".*(?=.*Success).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Audit User Account Management' is set to 'Success and Failure'
  description: |-
    This subcategory reports each event of user account management, such as when a
    user account is created, changed, or deleted; a user account is renamed, disabled, or
    enabled; or a password is set or changed. If you enable this Audit policy setting,
    administrators can track events to detect malicious, accidental, and authorized creation
    of user accounts. Events for this subcategory include:
    •
    •
    •
    •
    •
    •
    •
    •
    •
    •
    •
    •
    •
    •
    •
    •

    4720: A user account was created.
    4722: A user account was enabled.
    4723: An attempt was made to change an account's password.
    4724: An attempt was made to reset an account's password.
    4725: A user account was disabled.
    4726: A user account was deleted.
    4738: A user account was changed.
    4740: A user account was locked out.
    4765: SID History was added to an account.
    4766: An attempt to add SID History to an account failed.
    4767: A user account was unlocked.
    4780: The ACL was set on accounts which are members of administrators
    groups.
    4781: The name of an account was changed:
    4794: An attempt was made to set the Directory Services Restore Mode.
    5376: Credential Manager credentials were backed up.
    5377: Credential Manager credentials were restored from a backup.

    The recommended state for this setting is: Success and Failure.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Success and Failure.
    Auditing\Audit User Account Management
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Audit\\UserAccountManagement' AND data = '3';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Detailed Tracking Audit PNP Activity' is set to include 'Success'
  description: |-
    Creates audit events whenever a plug and play external device is detected.
    Attaching unapproved devices could cause Windows to install unapproved software.
    This also makes it easier to investigate a future security incident if required.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the
    following UI path to 'Success':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Detailed Tracking\Audit PNP Activity'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input =
    "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/DetailedTracking_AuditPNPActivity</LocURI></Target></Item></Get></SyncBody>"
    AND (mdm_command_output = "1" OR mdm_command_output = "3");
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Detailed Tracking Audit Process Creation' is set to include 'Success'
  description: |-
    Creates audit events whenever a process is executed.
    This makes it easier to investigate a future security incident if required.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Success':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Detailed Tracking\Audit Process Creation'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input =
    "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/DetailedTracking_AuditProcessCreation</LocURI></Target></Item></Get></SyncBody>"
    AND (mdm_command_output = "1" OR mdm_command_output = "3");
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Object Access Audit Detailed File Share' is set to include 'Failure'
  description: |-
    This subcategory allows you to audit attempts to access files and folders on a shared folder. Events for this subcategory include:
    - 5145: network share object was checked to see whether client can be granted desired access.
    The recommended state for this setting is to include: Failure
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to include Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Object Access\Audit Detailed File Share'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/ObjectAccess_AuditDetailedFileShare</LocURI></Target></Item></Get></SyncBody>"
    AND (mdm_command_output = 2 OR mdm_command_output = 3);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Object Access Audit Other Object Access Events' is set to 'Success and Failure'
  description: |-
    This policy setting allows you to audit events generated by the management of task scheduler jobs or COM+ objects.
    For scheduler jobs, the following are audited:
    -  Job created.
    -  Job deleted.
    -  Job enabled.
    -  Job disabled.
    -  Job updated.
    For COM+ objects, the following are audited:
    -  Catalog object added.
    -  Catalog object updated.
    -  Catalog object deleted.
    The recommended state for this setting is: Success and Failure.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to Success and Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Object Access\Audit Other Object Access Events'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/ObjectAccess_AuditOtherObjectAccessEvents</LocURI></Target></Item></Get></SyncBody>"
    AND mdm_command_output = 3;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Object Access Audit Removable Storage' is set to 'Success and Failure'
  description: |-
    This policy setting allows you to audit user attempts to access file system objects on a removable storage device. A security audit event is generated only for all objects for all types of access requested. If you configure this policy setting, an audit event is generated each time an account accesses a file system object on a removable storage. Success audits record successful attempts and Failure audits record unsuccessful attempts. If you do not configure this policy setting, no audit event is generated when an account accesses a file system object on a removable storage.
    The recommended state for this setting is: Success and Failure.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to Success and Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Object Access\Audit Removable Storage'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/ObjectAccess_AuditRemovableStorage</LocURI></Target></Item></Get></SyncBody>"
    AND mdm_command_output = 3;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Policy Change Audit MPSSVC Rule Level Policy Change' is set to 'Success and Failure'
  description: |-
    This subcategory determines whether the operating system generates audit events when changes are made to policy rules for the Microsoft Protection Service (MPSSVC.exe). Events for this subcategory include:
    -  4944: The following policy was active when the Windows Firewall started.
    -  4945: A rule was listed when the Windows Firewall started.
    -  4946: A change has been made to Windows Firewall exception list. A rule was added.
    -  4947: A change has been made to Windows Firewall exception list. A rule was modified.
    -  4948: A change has been made to Windows Firewall exception list. A rule was deleted.
    -  4949: Windows Firewall settings were restored to the default values.
    -  4950: A Windows Firewall setting has changed.
    -  4951: A rule has been ignored because its major version number was not recognized by Windows Firewall.
    -  4952: Parts of a rule have been ignored because its minor version number was not recognized by Windows Firewall. The other parts of the rule will be enforced.
    -  4953: A rule has been ignored by Windows Firewall because it could not parse the rule.
    -  4954: Windows Firewall Group Policy settings have changed. The new settings have been applied.
    -  4956: Windows Firewall has changed the active profile.
    -  4957: Windows Firewall did not apply the following rule.
    -  4958: Windows Firewall did not apply the following rule because the rule referred to items not configured on this computer.
    The recommended state for this setting is : Success and Failure
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to include Success and Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit MPSSVC Rule- Level Policy Change'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/PolicyChange_AuditMPSSVCRuleLevelPolicyChange</LocURI></Target></Item></Get></SyncBody>"
    AND mdm_command_output = 3;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Policy Change Audit Other Policy Change Events' is set to include 'Failure'
  description: |-
    This subcategory contains events about EFS Data Recovery Agent policy changes, changes in Windows Filtering Platform filter, status on Security policy settings updates for local Group Policy settings, Central Access Policy changes, and detailed troubleshooting events for Cryptographic Next Generation (CNG) operations.
    -  5063: A cryptographic provider operation was attempted.
    -  5064: A cryptographic context operation was attempted.
    -  5065: A cryptographic context modification was attempted.
    -  5066: A cryptographic function operation was attempted.
    -  5067: A cryptographic function modification was attempted.
    -  5068: A cryptographic function provider operation was attempted.
    -  5069: A cryptographic function property operation was attempted.
    -  5070: A cryptographic function property modification was attempted.
    -  6145: One or more errors occurred while processing security policy in the group
    policy objects.
    The recommended state for this setting is to include: Failure.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to include Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Other Policy Change Events'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/PolicyChange_AuditOtherPolicyChangeEvents</LocURI></Target></Item></Get></SyncBody>"
    AND (mdm_command_output = 2 OR mdm_command_output = 3);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Privilege Use Audit Sensitive Privilege Use' is set to 'Success and Failure'
  description: |-
    This subcategory reports when a user account or service uses a sensitive privilege. A sensitive privilege includes the following user rights:
    -  Act as part of the operating system
    -  Back up files and directories
    -  Create a token object
    -  Debug programs
    -  Enable computer and user accounts to be trusted for delegation
    -  Generate security audits
    -  Impersonate a client after authentication
    -  Load and unload device drivers
    -  Manage auditing and security log
    -  Modify firmware environment values
    -  Replace a process-level token
    -  Restore files and directories
    -  Take ownership of files or other objects
    Auditing this subcategory will create a high volume of events. Events for this subcategory include:
    -  4672: Special privileges assigned to new logon.
    -  4673: A privileged service was called.
    -  4674: An operation was attempted on a privileged object.
    The recommended state for this setting is: 'Success and Failure'.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to include Success and Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Privilege Use\Audit Sensitive Privilege Use'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/PrivilegeUse_AuditSensitivePrivilegeUse</LocURI></Target></Item></Get></SyncBody>"
    AND mdm_command_output = 3;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'System Audit I Psec Driver' is set to 'Success and Failure'
  description: |-
    This subcategory reports on the activities of the Internet Protocol security (IPsec) driver.
    Events for this subcategory include:
    •

    •
    •
    •

    •

    •
    •

    •

    •

    4960: IPsec dropped an inbound packet that failed an integrity check. If this
    problem persists, it could indicate a network issue or that packets are being
    modified in transit to this computer. Verify that the packets sent from the remote
    computer are the same as those received by this computer. This error might also
    indicate interoperability problems with other IPsec implementations.
    4961: IPsec dropped an inbound packet that failed a replay check. If this problem
    persists, it could indicate a replay attack against this computer.
    4962: IPsec dropped an inbound packet that failed a replay check. The inbound
    packet had too low a sequence number to ensure it was not a replay.
    4963: IPsec dropped an inbound clear text packet that should have been
    secured. This is usually due to the remote computer changing its IPsec policy
    without informing this computer. This could also be a spoofing attack attempt.
    4965: IPsec received a packet from a remote computer with an incorrect Security
    Parameter Index (SPI). This is usually caused by malfunctioning hardware that is
    corrupting packets. If these errors persist, verify that the packets sent from the
    remote computer are the same as those received by this computer. This error
    may also indicate interoperability problems with other IPsec implementations. In
    that case, if connectivity is not impeded, then these events can be ignored.
    5478: IPsec Services has started successfully.
    5479: IPsec Services has been shut down successfully. The shutdown of IPsec
    Services can put the computer at greater risk of network attack or expose the
    computer to potential security risks.
    5480: IPsec Services failed to get the complete list of network interfaces on the
    computer. This poses a potential security risk because some of the network
    interfaces may not get the protection provided by the applied IPsec filters. Use
    the IP Security Monitor snap-in to diagnose the problem.
    5483: IPsec Services failed to initialize RPC server. IPsec Services could not be
    started.
    •

    •

    5484: IPsec Services has experienced a critical failure and has been shut down.
    The shutdown of IPsec Services can put the computer at greater risk of network
    attack or expose the computer to potential security risks.
    5485: IPsec Services failed to process some IPsec filters on a plug-and-play
    event for network interfaces. This poses a potential security risk because some
    of the network interfaces may not get the protection provided by the applied
    IPsec filters. Use the IP Security Monitor snap-in to diagnose the problem.

    The recommended state for this setting is: Success and Failure.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Success and Failure.
    Auditing\System Audit I Psec Driver
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Audit\\IPsecDriver' AND data = '3';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'System Audit Other System Events' is set to 'Success and Failure'
  description: |-
    This subcategory reports on other system events. Events for this subcategory include:
    -  5024 : The Windows Firewall Service has started successfully.
    -  5025 : The Windows Firewall Service has been stopped.
    -  5027 : The Windows Firewall Service was unable to retrieve the security policy from the local storage. The service will continue enforcing the current policy.
    -  5028 : The Windows Firewall Service was unable to parse the new security policy. The service will continue with currently enforced policy.
    -  5029: The Windows Firewall Service failed to initialize the driver. The service will continue to enforce the current policy.
    -  5030: The Windows Firewall Service failed to start.
    -  5032: Windows Firewall was unable to notify the user that it blocked an application from accepting incoming connections on the network.
    -  5033 : The Windows Firewall Driver has started successfully.
    -  5034 : The Windows Firewall Driver has been stopped.
    -  5035 : The Windows Firewall Driver failed to start.
    -  5037 : The Windows Firewall Driver detected critical runtime error. Terminating.
    -  5058: Key file operation.
    -  5059: Key migration operation.
    The recommended state for this setting is: 'Success and Failure'.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to include Success and Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit Other System Events'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/System_AuditOtherSystemEvents</LocURI></Target></Item></Get></SyncBody>"
    AND mdm_command_output = 3;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'System Audit Security State Change' is set to include 'Success'
  description: |-
    This subcategory reports changes in security state of the system, such as when the security subsystem starts and stops. Events for this subcategory include:
    -  4608: Windows is starting up.
    -  4609: Windows is shutting down.
    -  4616: The system time was changed.
    -  4621: Administrator recovered system from CrashOnAuditFail. Users who are not
    administrators will now be allowed to log on. Some audit-able activity might not have been recorded.
    The recommended state for this setting is to include: 'Success'.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to include Success:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit Security State Change'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/System_AuditSecurityStateChange</LocURI></Target></Item></Get></SyncBody>"
    AND (mdm_command_output = 3 OR mdm_command_output = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'System Audit System Integrity' is set to 'Success and Failure'
  description: |-
    This subcategory reports on violations of integrity of the security subsystem. Events for this subcategory include:
    -  4612 : Internal resources allocated for the queuing of audit messages have been exhausted, leading to the loss of some audits.
    -  4615 : Invalid use of LPC port.
    -  4618 : A monitored security event pattern has occurred.
    -  4816 : RPC detected an integrity violation while decrypting an incoming message.
    -  5038 : Code integrity determined that the image hash of a file is not valid. The file could be corrupt due to unauthorized modification or the invalid hash could indicate a potential disk device error.
    -  5056: A cryptographic self test was performed.
    -  5057: A cryptographic primitive operation failed.
    -  5060: Verification operation failed.
    -  5061: Cryptographic operation.
    -  5062: A kernel-mode cryptographic self test was performed.
    The recommended state for this setting is: Success and Failure.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to include Success and Failure:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit System Integrity'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/Audit/System_AuditSystemIntegrity</LocURI></Target></Item></Get></SyncBody>"
    AND mdm_command_output = 3;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Config refresh' is set to 'Enabled'
  description: |-
    This policy setting determines whether or not MDM policies are refreshed on the
    system.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled.
    Config Refresh\Config refresh
  query: SELECT 1 FROM registry WHERE (path LIKE 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Enrollments\\%\\ConfigRefresh:Enabled' AND cast(data as integer) = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Refresh cadence' is set to '90' (or less)
  description: |-
    This policy setting determines how often MDM policies are refreshed on the system.
    The recommended state for this setting is: 90 (or less).
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 90 (or less).
    Config Refresh\Refresh cadence

    Note: The shortest configurable refresh interval is 30 minutes.
  query: SELECT 1 FROM registry WHERE (path LIKE 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Enrollments\\%\\ConfigRefresh:Cadence' AND cast(data as integer) <= 90);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Behavior Monitoring' is set to 'Allowed'
  description: |-
    This policy setting allows you to configure behavior monitoring for Microsoft Defender
    Antivirus.
    The recommended state for this setting is: Allowed.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Allowed.
    Defender\Allow Behavior Monitoring
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Policy Manager\\AllowBehaviorMonitoring' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Email Scanning' is set to 'Allowed'
  description: |-
    This policy setting allows you to configure e-mail scanning. When e-mail scanning is
    enabled, the engine will parse the mailbox and mail files, according to their specific
    format, in order to analyze the mail bodies and attachments. Several e-mail formats are
    currently supported, for example: pst (Outlook), dbx, mbx, mime (Outlook Express),
    binhex (Mac).
    The recommended state for this setting is: Allowed.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Allowed.
    Defender\Allow Email Scanning
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Policy Manager\\AllowEmailScanning' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Full Scan Removable Drive Scanning' is set to 'Allowed'
  description: |-
    This policy setting allows you to manage whether or not to scan for malicious software
    and unwanted software in the contents of removable drives, such as USB flash drives,
    when running a full scan.
    The recommended state for this setting is: Allowed.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Allowed.
    Defender Antivirus\Allow Full Scan Removable Drive Scanning
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Policy Manager\\AllowFullScanRemovableDriveScanning' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Realtime Monitoring' is set to 'Allowed'
  description: |-
    This policy setting configures real-time protection prompts for known malware detection.
    Microsoft Defender Antivirus alerts you when malware or potentially unwanted software
    attempts to install itself or to run on your computer.
    The recommended state for this setting is: Allowed.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Allowed.
    Defender\Allow Realtime Monitoring
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Policy Manager\\AllowRealtimeMonitoring' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow scanning of all downloaded files and attachments' is set to 'Allowed'
  description: |-
    This policy setting configures scanning for all downloaded files and attachments.
    The recommended state for this setting is: Allowed.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Allowed.
    Defender\Allow scanning of all downloaded files and attachments
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Policy Manager\\AllowIOAVProtection' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Script Scanning' is set to 'Allowed'
  description: |-
    This policy setting allows script scanning to be turned on/off. Script scanning intercepts
    scripts then scans them before they are executed on the system.
    The recommended state for this setting is: Allowed.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Allowed.
    Defender\Allow Script Scanning
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Policy Manager\\AllowScriptScanning' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block abuse of exploited vulnerable signed drivers'' is set to ''Block`'
  description: |-
    This rule prevents an application from writing a vulnerable signed driver to disk.
    The recommended state for this setting is: Block.
    Note: The Block abuse of exploited vulnerable signed drivers rule does not block a
    driver that already exists on the system from being loaded.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block.
    Defender\Block abuse of exploited vulnerable signed drivers (Device)
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\56a863a9-875e-4185-98a7-b882c64b5ce5'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block Adobe Reader from creating child processes'' is set to ''Block'''
  description: |-
    This rule prevents attacks by blocking Adobe Reader from creating processes.
    Malware can download and launch payloads and break out of Adobe Reader through
    social engineering or exploits. By blocking child processes from being generated by
    Adobe Reader, malware attempting to use Adobe Reader as an attack vector are
    prevented from spreading.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block.
    Defender\Block Adobe Reader from creating child processes
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\7674ba52-37eb-4a4f-a9a1-f0f9a1619a2c'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block all Office applications from creating child processes'' is set to ''Audit'' or higher'
  description: |-
    This rule blocks Office apps from creating child processes. Office apps include Word,
    Excel, PowerPoint, OneNote, and Access.
    Creating malicious child processes is a common malware strategy. Malware that
    abuses Office as a vector often runs VBA macros and exploit code to download and
    attempt to run more payloads. However, some legitimate line-of-business applications
    might also generate child processes for benign purposes; such as spawning a
    command prompt or using PowerShell to configure registry settings.
    The recommended state for this setting is: Audit. Configuring this setting to Block also
    conforms to the benchmark.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Audit or Block.
    Defender\Block all Office applications from creating child processes
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\d4f940ab-401b-4efc-aadc-ad5f3c50688a'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block credential stealing from the Windows local security authority subsystem'' is set to ''Block'''
  description: |-
    This rule helps prevent credential stealing by locking down Local Security Authority
    Subsystem Service (LSASS).
    LSASS authenticates users who sign in on a Windows computer. Microsoft Defender
    Credential Guard in Windows normally prevents attempts to extract credentials from
    LSASS. Some organizations can't enable Credential Guard on all of their computers
    because of compatibility issues with custom smartcard drivers or other programs that
    load into the Local Security Authority (LSA). In these cases, attackers can use tools like
    Mimikatz to scrape cleartext passwords and NTLM hashes from LSASS.
    Note: Enabling this rule doesn't provide additional protection if you have LSA protection
    enabled since the ASR rule and LSA protection work similarly. However, when LSA
    protection cannot be enabled, this rule can be configured to provide equivalent
    protection against malware that target lsass.exe.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block.
    Defender\Block credential stealing from the Windows local security authority
    subsystem
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block executable content from email client and webmail'' is set to ''Block'''
  description: |-
    This rule blocks email opened within the Microsoft Outlook application, or Outlook.com
    and other popular webmail providers from propagating the following file types:
    •
    •

    Executable files (such as .exe, .dll, or .scr)
    Script files (such as a PowerShell .ps1, Visual Basic .vbs, or JavaScript .js file)

    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block.
    Defender\Block executable content from email client and webmail
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\be9ba2d9-53ea-4cdc-84e5-9b1eeee46550'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block executable files from running unless they meet a prevalence, age, or trusted list criterion'' is set to ''Audit'' or higher'
  description: |-
    This rule blocks executable files, such as .exe, .dll, or .scr, from launching. Thus,
    launching untrusted or unknown executable files can be risky, as it might not be initially
    clear if the files are malicious.
    The recommended state for this setting is: Audit. Configuring this setting to Block also
    conforms to the benchmark.
    Note: Cloud-delivered protection must be enabled to use this rule.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Audit or Block.
    Defender\Block executable files from running unless they meet a prevalence,
    age, or trusted list criterion
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\01443614-cd74-433a-b99e-2ecdc07bfc25'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block execution of potentially obfuscated scripts'' is set to ''Audit'' or higher'
  description: |-
    This rule blocks Office apps from creating child processes. Office apps include Word,
    Excel, PowerPoint, OneNote, and Access.
    Creating malicious child processes is a common malware strategy. Malware that
    abuses Office as a vector often runs VBA macros and exploit code to download and
    attempt to run more payloads. However, some legitimate line-of-business applications
    might also generate child processes for benign purposes; such as spawning a
    command prompt or using PowerShell to configure registry settings.
    The recommended state for this setting is: Audit. Configuring this setting to Block also
    conforms to the benchmark.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Audit or Block.
    Defender\Block execution of potentially obfuscated scripts
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\5beb7efe-fd9a-4556-801d-275e5ffc04cc'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block JavaScript or VBScript from launching downloaded executable content'' is set to ''Block'''
  description: |-
    This rule prevents scripts from launching potentially malicious downloaded content.
    Malware written in JavaScript or VBScript often acts as a downloader to fetch and
    launch other malware from the Internet. Although not common, line-of-business
    applications sometimes use scripts to download and launch installers.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block.
    Defender\Block JavaScript or VBScript from launching downloaded executable
    content
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\d3e037e1-3eb8-44c8-a917-57927947596d'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block Office applications from creating executable content'' is set to ''Block'''
  description: |-
    This rule prevents scripts from launching potentially malicious downloaded content.
    Malware written in JavaScript or VBScript often acts as a downloader to fetch and
    launch other malware from the Internet. Although not common, line-of-business
    applications sometimes use scripts to download and launch installers.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block.
    Defender\Block Office applications from creating executable content
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\3b576869-a4ec-4529-8536-b80a7769e899'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block Office applications from injecting code into other processes'' is set to ''Block'''
  description: |-
    Attackers might attempt to use Office apps to migrate malicious code into other
    processes through code injection, so the code can masquerade as a clean process.
    There are no known legitimate business purposes for using code injection.
    This rule applies to Word, Excel, OneNote, and PowerPoint.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block.
    Defender\Block Office applications from injecting code into other processes
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\75668c1f-73b5-4cf0-bb93-3ecf5cb7cc84'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block Office communication application from creating child processes'' is set to ''Audit'' or higher'
  description: |-
    This rule prevents Outlook from creating child processes, while still allowing legitimate
    Outlook functions.
    The recommended state for this setting is: Audit. Configuring this setting to Block also
    conforms to the benchmark.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Audit or Block.
    Defender\Block Office communication application from creating child processes
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\26190899-1602-49e8-8b27-eb1d0a1ce869'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block persistence through WMI event subscription'' is set to ''Block'''
  description: |-
    This rule prevents malware from abusing WMI to attain persistence on a device.
    Note: If CcmExec.exe (SCCM Agent) is detected on the device, the ASR rule is
    classified as "not applicable" in Defender for Endpoint settings in the Microsoft Defender
    portal.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block.
    Defender\Block persistence through WMI event subscription
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\e6db77e5-3df2-4cf1-b95a-636979351e5b'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block process creations originating from PSExec and WMI commands'' is set to ''Audit'' or higher'
  description: |-
    This rule blocks processes created through PsExec and WMI from running. Both
    PsExec and WMI can remotely execute code.
    The recommended state for this setting is: Audit. Configuring this setting to Block also
    conforms to the benchmark.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Audit or Block.
    Defender\Block process creations originating from PSExec and WMI commands
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\d1e49aac-8f56-4280-b9ba-993a6d77406c'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block untrusted and unsigned processes that run from USB'' is set to ''Block'''
  description: |-
    With this rule, admins can prevent unsigned or untrusted executable files from running
    from USB removable drives, including SD cards. Blocked file types include executable
    files (such as .exe, .dll, or .scr)
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block.
    Defender\Block untrusted and unsigned processes that run from USB
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\b2b3f03d-6a65-4f7b-a9c7-1c7ef74a9ba4'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Block Win32 API calls from Office macros'' is set to ''Block'''
  description: |-
    This rule prevents VBA macros from calling Win32 APIs. Office VBA enables Win32 API
    calls.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block.
    Defender\Block Win32 API calls from Office macros
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\92e97fa1-2edf-4476-bdd6-9dd0b4dddc7b'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''ASR: Use advanced protection against ransomware'' is set to ''Audit'' or higher'
  description: |-
    This rule provides an extra layer of protection against ransomware. It uses both client
    and cloud heuristics to determine whether a file resembles ransomware. This rule
    doesn't block files that have one or more of the following characteristics:
    The file has already been found to be unharmful in the Microsoft cloud. The file is a valid
    signed file. The file is prevalent enough to not be considered as ransomware. The rule
    tends to err on the side of caution to prevent ransomware.
    The recommended state for this setting is: Audit. Configuring this setting to Block also
    conforms to the benchmark.
    Note: Cloud-delivered protection must be enabled to use this rule.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Audit or Block.
    Defender\Use advanced protection against ransomware
  query: |-
    SELECT 1
    WHERE EXISTS (
      SELECT 1
      FROM registry
      WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PolicyManager\\ASR\\Rules\\c1db55ab-c21a-4637-bb3f-a12568109d35'
        AND data = 1
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Days Until Aggressive Catchup Quick Scan' is set to '7 days' or fewer
  description: |-
    This policy setting configures the number of days after the last scan (of any type) before
    an aggressive Quick Scan is automatically triggered.
    The recommended state for this setting is: 7 days or fewer.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 7 days or fewer.
    Defender\Days Until Aggressive Catchup Quick Scan
  query: |-
    SELECT 1 FROM registry
    WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Scan\\DaysUntilAggressiveCatchupQuickScan'
      AND data = 7;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable Network Protection' is set to 'Enabled (block mode)'
  description: |-
    This policy setting controls Microsoft Defender Exploit Guard network protection.
    The recommended state for this setting is: Enabled (block mode).
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled (block mode):
    Defender\Enable Network Protection
  query: SELECT 1 FROM services WHERE name = 'block mode' AND start_type != 'DISABLED';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Hide Exclusions From Local Users' is set to 'Enabled'
  description: |-
    This policy setting controls whether Microsoft Defender Antivirus exclusions are visible
    to local users on the system.
    The recommended state for this setting is: If you enable this setting, local
    users will no longer be able to see the exclusion list in Windows
    Security App or via PowerShell..
    Note: As of the publication of this Benchmark, the setting configuration state in Intune is
    the sentence above after The recommended state for this setting is: and not Enabled as
    the title states. This was done to keep title length to a minimum.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to If you enable this setting, local users will no
    longer be able to see the exclusion list in Windows Security App or
    via PowerShell..
    Defender\Hide Exclusions From Local Users
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableLocalAdminMerge' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Oobe Enable Rtp And Sig Update' is set to 'Enabled'
  description: |-
    This policy setting configures whether Real-time Protection and Security Intelligence
    Updates are enabled during the Out of Box experience (OOBE).
    The recommended state for this setting is: If you enable this setting, realtime protection and Security Intelligence Updates are enabled during
    OOBE..
    Note: As of the publication of this Benchmark, the setting configuration state in Intune is
    the sentence above after The recommended state for this setting is: and not Enabled as
    the title states. This was done to keep title length to a minimum.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to If you enable this setting, real-time protection
    and Security Intelligence Updates are enabled during OOBE..
    Defender\Oobe Enable Rtp And Sig Update
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Signature Updates\\OobeEnableRtpSignatureUpdate' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'PUA Protection' is set to 'PUA Protection on'
  description: |-
    This policy setting controls detection and action for Potentially Unwanted Applications
    (PUA), which are sneaky unwanted application bundlers or their bundled applications,
    that can deliver adware or malware.
    The recommended state for this setting is: PUA Protection on.
    For more information, see this link: Block potentially unwanted applications with
    Microsoft Defender Antivirus | Microsoft Docs
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to PUA
    Protection on:
    Defender\PUA Protection
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PUAProtection' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Quick Scan Include Exclusions' is set to '1'
  description: |-
    This policy setting manages whether or not Microsoft Defender Antivirus scans
    excluded files and directories when running a Quick Scan.
    The recommended state for this setting is: If you set this setting to 1, all
    files and directories that are excluded from real-time protection
    using contextual exclusions are scanned during a quick scan.
    Note: As of the publication of this Benchmark, the setting configuration state in Intune is
    the sentence above after The recommended state for this setting is: and not 1 as the
    title states. This was done to keep title length to a minimum.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to If you set this setting to 1, all files and
    directories that are excluded from real-time protection using
    contextual exclusions are scanned during a quick scan.
    Defender\Quick Scan Include Exclusions
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Scan\\QuickScanIncludeExclusions' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Remote Encryption Protection Configured State'' is set to ''Audit: Generate EDR detections without blocking'' or higher'
  description: |-
    This policy setting configures the Brute-Force Protection feature in Microsoft Defender
    Antivirus. Brute-Force Protection can detect and block attempts to forcibly initiate signins and sessions.
    The recommended state for this setting is: Audit: Generate EDR detections
    without blocking. Configuring this setting to Block: Prevent suspicious and
    malicious behaviors also conforms to the benchmark.
    Note: Configuring the value to either Default or Off does not conform to this
    benchmark.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Audit: Generate EDR detections without blocking or
    Block: Prevent suspicious and malicious behaviors.
    Defender\Remote Encryption Protection Configured State
  query: |-
    SELECT 1 FROM registry
    WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Policy Manager\\RemoteEncryptionProtectionConfiguredState'
      AND data IN (1, 2);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'DO Download Mode' is NOT set to 'HTTP blended with Internet Peering'
  description: |-
    This policy setting specifies the download method that Delivery Optimization can use in
    downloads of Windows Updates, Apps and App updates. The following methods are
    supported:
    •
    •
    •

    •
    •

    •

    0 = HTTP only, no peering.
    1 = HTTP blended with peering behind the same NAT.
    2 = HTTP blended with peering across a private group. Peering occurs on
    devices in the same Active Directory Site (if exist) or the same domain by default.
    When this option is selected, peering will cross NATs. To create a custom group
    use Group ID in combination with Mode 2.
    3 = HTTP blended with Internet Peering.
    99 = Simple download mode with no peering. Delivery Optimization downloads
    using HTTP only and does not attempt to contact the Delivery Optimization cloud
    services.
    100 = Bypass mode. Do not use Delivery Optimization and use BITS instead.

    The recommended state for this setting is any value EXCEPT: Enabled: Internet
    (3).
    Note: The default on all SKUs other than Enterprise, Enterprise LTSB or Education is
    Enabled: Internet (3), so on other SKUs, be sure to set this to a different value.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to any value other than HTTP blended with Internet
    Peering:
    Delivery Optimization\DO Download Mode
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DeliveryOptimization\\DODownloadMode' AND data = 3);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Configure System Guard Launch' is set to 'Unmanaged Enables Secure Launch if supported by hardware'
  description: |-
    Secure Launch protects the Virtualization Based Security environment from exploited
    vulnerabilities in device firmware.
    The recommended state for this setting is: Unmanaged Enables Secure Launch if
    supported by hardware.
    Note: Credential Guard and Device Guard are not currently supported when using
    Azure IaaS VMs.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Unmanaged Enables Secure Launch if supported by
    hardware:
    Device Guard\Configure System Guard Launch
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\EnableSecureLaunch' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Credential Guard' is set to 'Enabled with UEFI lock'
  description: |-
    This setting lets users turn on Credential Guard with virtualization-based security to help
    protect credentials. The "Enabled with UEFI lock" option ensures that Credential Guard
    cannot be disabled remotely. In order to disable the feature, you must set the Group
    Policy to "Disabled" as well as remove the security functionality from each computer,
    with a physically present user, in order to clear configuration persisted in UEFI.
    The recommended state for this setting is: Enabled with UEFI lock.
    Note: Virtualization Based Security requires a 64-bit version of Windows with Secure
    Boot enabled, which in turn requires that Windows was installed with a UEFI BIOS
    configuration, not a Legacy BIOS configuration. In addition, if running Windows on a
    virtual machine, the hardware-assisted CPU virtualization feature (Intel VT-x or AMD-V)
    must be exposed by the host to the guest VM.
    More information on system requirements for this feature can be found at Windows
    Defender Credential Guard Requirements (Windows 10) | Microsoft Docs
    Note #2: Credential Guard and Device Guard are not currently supported when using
    Azure IaaS VMs.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled with UEFI lock:
    Device Guard\Credential Guard
  query: SELECT 1 FROM REGISTRY WHERE (PATH = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DeviceGuard\\LsaCfgFlags' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable Virtualization Based Security' is set to 'Enable virtualization based security'
  description: |-
    This policy setting specifies whether Virtualization Based Security is enabled.
    Virtualization Based Security uses the Windows Hypervisor to provide support for
    security services.
    The recommended state for this setting is: Enable virtualization based security.
    Note: Virtualization Based Security requires a 64-bit version of Windows with Secure
    Boot enabled, which in turn requires that Windows was installed with a UEFI BIOS
    configuration, not a Legacy BIOS configuration. In addition, if running Windows on a
    virtual machine, the hardware-assisted CPU virtualization feature (Intel VT-x or AMD-V)
    must be exposed by the host to the guest VM.
    More information on system requirements for this feature can be found at Windows
    Defender Credential Guard Requirements (Windows 10) | Microsoft Docs
    Note #2: Credential Guard and Device Guard are not currently supported when using
    Azure IaaS VMs.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enable virtualization based security:
    Device Guard\Enable Virtualization Based Security
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\EnableVirtualizationBasedSecurity' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Require Platform Security Features' is set to 'Turns on VBS with Secure Boot' or higher
  description: |-
    This policy setting specifies whether Virtualization Based Security (VBS) is enabled.
    VBS uses the Windows Hypervisor to provide support for security services.
    The recommended state for this setting is: Turns on VBS with Secure Boot or
    Turns on VBS with Secure Boot and direct memory access (DMA). DMA
    requires hardware support.
    Note: VBS requires a 64-bit version of Windows with Secure Boot enabled, which in
    turn requires that Windows was installed with a UEFI BIOS configuration, not a Legacy
    BIOS configuration. In addition, if running Windows on a virtual machine, the hardwareassisted CPU virtualization feature (Intel VT-x or AMD-V) must be exposed by the host
    to the guest VM.
    More information on system requirements for this feature can be found at Windows
    Defender Credential Guard Requirements (Windows 10) | Microsoft Docs
    Note #2: Credential Guard and Device Guard are not currently supported when using
    Azure IaaS VMs.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Turns on VBS with Secure Boot or Turns on VBS with
    Secure Boot and direct memory access (DMA). DMA requires hardware
    support:
    Device Guard\Require Platform Security Features
  query: SELECT 1 FROM REGISTRY WHERE (PATH = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DeviceGuard\\RequirePlatformSecurityFeatures' AND data in (1,3));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Device Password Enabled' is set to 'Enabled'
  description: |-
    This policy setting specifics whether device lock is enabled. when enabled, the following
    policy settings take effect on the system which are included in the Device Lock Section:
    •
    •
    •
    •
    •
    •

    AllowSimpleDevicePassword
    MinDevicePasswordLength
    AlphanumericDevicePasswordRequired
    MaxDevicePasswordFailedAttempts
    MaxInactivityTimeDeviceLock
    MinDevicePasswordComplexCharacters

    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to `3Enabled:
    Device Lock\Device Password Enabled
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\PolicyManager\\current\\device\\DeviceLock\\DevicePasswordEnabled' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Device Password Enabled: Alphanumeric Device Password Required'' is set to ''Password or Alphanumeric PIN required'''
  description: |-
    This policy setting determines the type of PIN or password this is required on a system.
    The recommended state for this setting is: Password or Alphanumeric PIN
    required.
    Note: This policy only applies if the DevicePasswordEnabled policy is set to 1. This is a
    pre-requisite for Alphanumeric Device Password Required in the settings catalog.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Password or Alphanumeric PIN required:
    Device Lock\Device Password Enabled: Alphanumeric Device Password Required
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\PolicyManager\\current\\device\\DeviceLock\\DevicePasswordEnabled' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Device Password Enabled: Min Device Password Complex Characters'' is set to ''Digits and lowercase letters are required'''
  description: |-
    This policy setting configures the number of complex element types (uppercase and
    lowercase letters, numbers, and punctuation) required for PIN or password.
    The recommended state for this setting is: Digits and lowercase letters are
    required
    Note: The enforcement of policies for Microsoft accounts happens on the server, and
    the server requires a password length of 8 and a complexity of 2. A complexity value of
    3 or 4 is unsupported and setting this value on the server makes Microsoft accounts
    non-compliant. However, configuring this setting to 2 will force the value of 3 for
    Local accounts.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Digits lowercase letters and uppercase letters are
    required:
    Device Lock\Device Password Enabled: Alphanumeric Device Password Required:
    Min Device Password Complex Characters

    Note: As of March 20, 2025, this setting is nested under Alphanumeric Device
    Password Required and may not fully appear in Settings Catalog unless unchecked and
    re-checked in the settings picker.
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\PolicyManager\\current\\device\\DeviceLock\\MinDevicePasswordComplexCharacters' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Device Password Enabled: Device Password Expiration'' is set to ''365 or fewer days, but not 0'''
  description: |-
    This policy setting defines how long a user can use their password before it expires.
    The recommended state for this setting is 365 or fewer days, but not 0.
    Note: Values for this policy setting range from 0 to 730 days. If this policy is set to the
    value 0, the password will never expire.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 365 or fewer days, but not 0:
    Device Lock\Device Password Enabled: Device Password Expiration
  query: SELECT 1 FROM security_profile_info WHERE (maximum_password_age <= 365 AND maximum_password_age != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Device Password Enabled: Device Password History'' is set to ''24 or more password(s)'''
  description: |-
    This policy setting determines the number of renewed, unique passwords that have to
    be associated with a user account before you can reuse an old password. In an Intune
    managed environment this setting applies to local user accounts and not Entra ID
    accounts.
    The value includes the user's current password. This value denotes that with a setting of
    1, the user can't reuse their current password when choosing a new password, while a
    setting of 5 means that a user can't set their new password to their current password or
    any of their previous four passwords.
    The recommended state for this setting is: 24 or more password(s).
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 24 or more password(s):
    Device Lock\Device Password Enabled: Device Password History
  query: SELECT 1 FROM security_profile_info WHERE password_history_size >= 24;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Device Password Enabled: Max Device Password Failed Attempts'' is set to ''5 or fewer failed attempt(s), but not 0'''
  description: |-
    This policy setting determines the number of failed logon attempts before the account is
    locked. Setting this policy to 0 does not conform to the benchmark as doing so disables
    the account lockout threshold.
    The recommended state for this setting is: 5 or fewer invalid logon attempt(s),
    but not 0.
    Note: When a user reaches the value set by this policy, the system is not wiped,
    instead the system will be in BitLocker recovery mode, which makes data inaccessible
    but recoverable. If BitLocker is not enabled, then this policy will not be enforced.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 5 or fewer invalid logon attempt(s), but not 0:
    Device Lock\Device Password Enabled: Max Device Password Failed Attempts
  query: SELECT 1 FROM cis_audit where item = "1.2.2" and CAST(value as integer) <= 5 and CAST(value as integer) > 0;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Device Password Enabled: Max Inactivity Time Device Lock'' is set to ''15 or fewer minutes, but not 0'''
  description: |-
    Windows notices inactivity of a logon session, and if the amount of inactive time
    exceeds the inactivity limit, then the screen saver will run, locking the session.
    The recommended state for this setting is: 15 or fewer minutes, but not 0.
    Note: A value of 0 does not conform to the benchmark as it disables the machine
    inactivity limit.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 15 or fewer minutes, but not 0:
    Device Lock\Device Password Enabled: Max Inactivity Time Device Lock
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\InactivityTimeoutSecs' AND data <= 900 AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Device Password Enabled: Min Device Password Length'' is set to ''14 or more character(s)'''
  description: |-
    This policy setting determines the least number of characters that make up a password
    for a local user account. There are many different theories about how to determine the
    best password length for an organization, but perhaps "passphrase" is a better term
    than "password." In Microsoft Windows 2000 or newer, passphrases can be quite long
    and can include spaces. Therefore, a phrase such as "I want to drink a $5 milkshake" is
    a valid passphrase; it is a considerably stronger password than an 8 or 10 character
    string of random numbers and letters, and yet is easier to remember. Users must be
    educated about the proper selection and maintenance of passwords, especially around
    password length. In enterprise environments, the ideal value for the Minimum password
    length setting is 14 characters, however you should adjust this value to meet your
    organization's business requirements.
    The recommended state for this setting is: 14 or more character(s).
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 14 or more character(s):
    Device Lock\Device Password Enabled: Min Device Password Length
  query: SELECT 1 FROM security_profile_info WHERE minimum_password_length >= 14;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Minimum Password Age' is set to '1 or more day(s)'
  description: |-
    This policy setting determines the number of days that you must use a password before you can
    change it. The range of values for this policy setting is between 1 and 999 days.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 1 or more days:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Minimum password age'
  query: SELECT 1 FROM security_profile_info WHERE minimum_password_age >= 1;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Cortana' is set to 'Block'
  description: |-
    This policy setting specifies whether Cortana is allowed on the device.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block:
    Experience\Allow Cortana
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Windows Search\\AllowCortana' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Spotlight Collection (User)' is set to '0'
  description: |-
    This policy setting removes the Spotlight collection setting in Personalization, rendering
    the user unable to select and subsequently download daily images from Microsoft to the
    system desktop.
    The recommended state for this setting is: 0.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 0:
    Experience\Allow Spotlight Collection (User)
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\CloudContent\\DisableSpotlightCollectionOnDesktop' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Disable Consumer Account State Content' is set to 'Enabled'
  description: |-
    This policy setting determines whether cloud consumer account state content is allowed
    in all Windows experiences.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled:
    Experience\Disable Consumer Account State Content
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\CloudContent\\DisableConsumerAccountStateContent' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Do not show feedback notifications' is set to 'Feedback notifications are disabled'
  description: |-
    This policy setting allows an organization to prevent its devices from showing feedback
    questions from Microsoft.
    The recommended state for this setting is: Feedback notifications are disabled.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Feedback notifications are disabled:
    Experience\Do not show feedback notifications
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection\\DoNotShowFeedbackNotifications' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable Domain Network Firewall' is set to 'True'
  description: |-
    Select True (recommended) to have Windows Firewall with Advanced Security use the
    settings for this profile to filter network traffic. If you select False, Windows Firewall with
    Advanced Security will not use any of the firewall rules or connection security rules for
    this profile.
    The recommended state for this setting is: True.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to True:
    Firewall\Enable Domain Network Firewall
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\DomainProfile\\EnableFirewall' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Domain Network Firewall: Default Inbound Action for Domain Profile'' is set to ''Block'''
  description: |-
    This setting determines the behavior for inbound connections that do not match an
    inbound firewall rule.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block:
    Firewall\Enable Domain Network Firewall: Default Inbound Action for Domain
    Profile
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\Mdm\\DomainProfile\\DefaultInboundAction' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Domain Network Firewall: Disable Inbound Notifications'' is set to ''True'''
  description: |-
    Select this option to have Windows Firewall with Advanced Security display notifications
    to the user when a program is blocked from receiving inbound connections.
    The recommended state for this setting is: True.
    Note: When the Apply local firewall rules setting is configured to No, it's
    recommended to also configure the Display a notification setting to No.
    Otherwise, users will continue to receive messages that ask if they want to unblock a
    restricted inbound connection, but the user's response will be ignored.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to True:
    Firewall\Enable Domain Network Firewall: Disable Inbound Notifications
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\DomainProfile\\EnableFirewall' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Domain Network Firewall: Enable Log Dropped Packets'' is set to ''Yes: Enable Logging Of Dropped Packets'''
  description: |-
    Use this option to log when Windows Firewall with Advanced Security discards an inbound packet for any reason. The log records why and when the packet was dropped. Look for entries with the word DROP in the action column of the log.
    The recommended state for this setting is: Yes.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Yes:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Logging Customize\Log dropped packets'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging\LogDroppedPackets' and data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Domain Network Firewall: Enable Log Success Connections'' is set to ''Enable Logging Of Successful Connections'''
  description: |-
    Use this option to log when Windows Firewall with Advanced Security allows an
    inbound connection. The log records why and when the connection was formed. Look
    for entries with the word ALLOW in the action column of the log.
    The recommended state for this setting is: Enable Logging Of Successful
    Connections.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enable Logging Of Successful Connections:
    Firewall\Enable Domain Network Firewall: Enable Log Success Connections
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\DomainProfile\\EnableFirewall' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Domain Network Firewall: Log File Path'' is set to ''%SystemRoot%\System32\logfiles\firewall\domainfw.log'''
  description: |-
    Use this option to specify the path and name of the file in which Windows Firewall will
    write its log information.
    The recommended state for this setting is:
    %SystemRoot%\System32\logfiles\firewall\domainfw.log.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to
    %SystemRoot%\System32\logfiles\firewall\domainfw.log:
    Firewall\Enable Domain Network Firewall: Log File Path
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\DomainProfile\\LogFilePath' AND data LIKE '%%systemroot%\\system32\\logfiles\\firewall\\domainfw.log%';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Domain Network Firewall: Log Max File Size'' is set to ''16,384 KB or greater'''
  description: |-
    Use this option to specify the size limit of the file in which Windows Firewall will write its
    log information.
    The recommended state for this setting is: 16,384 KB or greater.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 16,384 KB or greater:
    Firewall\Enable Domain Network Firewall: Log Max File Size (KB)
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\DomainProfile\\LogFileSize' AND data = '16384';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable Private Network Firewall' is set to 'True'
  description: |-
    Select True (recommended) to have Windows Firewall with Advanced Security use the
    settings for this profile to filter network traffic. If you select False, Windows Firewall with
    Advanced Security will not use any of the firewall rules or connection security rules for
    this profile.
    The recommended state for this setting is: True (recommended).
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to True (recommended):
    Firewall\Enable Private Network Firewall
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile\\EnableFirewall' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Private Network Firewall: Default Inbound Action for Private Profile'' is set to ''Block'''
  description: |-
    This setting determines the behavior for inbound connections that do not match an
    inbound firewall rule.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block:
    Firewall\Enable Private Network Firewall: Default Inbound Action for Private
    Profile
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\Mdm\\StandardProfile\\DefaultInboundAction' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Private Network Firewall: Disable Inbound Notifications'' is set to ''True'''
  description: |-
    Select this option to have Windows Firewall with Advanced Security display notifications
    to the user when a program is blocked from receiving inbound connections.
    The recommended state for this setting is: True.
    Note: When the Apply local firewall rules setting is configured to No, it's
    recommended to also configure the Display a notification setting to No.
    Otherwise, users will continue to receive messages that ask if they want to unblock a
    restricted inbound connection, but the user's response will be ignored.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to True:
    Firewall\Enable Private Network Firewall: Disable Inbound Notifications
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile\\EnableFirewall' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Private Network Firewall: Enable Log Success Connections'' is set to ''Enable Logging Of Successful Connections'''
  description: |-
    Use this option to log when Windows Firewall with Advanced Security allows an
    inbound connection. The log records why and when the connection was formed. Look
    for entries with the word ALLOW in the action column of the log.
    The recommended state for this setting is: Enable Logging Of Successful
    Connections.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enable Logging Of Successful Connections:
    Firewall\Enable Private Network Firewall: Enable Log Success Connections
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile\\EnableFirewall' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Private Network Firewall: Enable Log Dropped Packets'' is set to ''Yes: Enable Logging Of Dropped Packets'''
  description: |-
    Use this option to log when Windows Firewall with Advanced Security discards an inbound packet for any reason. The log records why and when the packet was dropped. Look for entries with the word DROP in the action column of the log.
    The recommended state for this setting is: Yes.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Yes:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Logging Customize\Log dropped packets'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PrivateProfile\\Logging\LogDroppedPackets' and data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Private Network Firewall: Log File Path'' is set to ''%SystemRoot%\System32\logfiles\firewall\privatefw.log'''
  description: |-
    Use this option to specify the path and name of the file in which Windows Firewall will
    write its log information.
    The recommended state for this setting is:
    %SystemRoot%\System32\logfiles\firewall\privatefw.log.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to
    %SystemRoot%\System32\logfiles\firewall\privatefw.log:
    Firewall\Enable Private Network Firewall: Log File Path
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile\\LogFilePath' AND data LIKE '%%systemroot%\\system32\\logfiles\\firewall\\privatefw.log%';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Private Network Firewall: Log Max File Size'' is set to ''16,384 KB or greater'''
  description: |-
    Use this option to specify the size limit of the file in which Windows Firewall will write its
    log information.
    The recommended state for this setting is: 16,384 KB or greater.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 16,384 KB or greater:
    Firewall\Enable Private Network Firewall: Log Max File Size (KB)
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile\\LogFileSize' AND data = '16384';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable Public Network Firewall' is set to 'True'
  description: |-
    Select True (recommended) to have Windows Firewall with Advanced Security use the
    settings for this profile to filter network traffic. If you select False, Windows Firewall with
    Advanced Security will not use any of the firewall rules or connection security rules for
    this profile.
    The recommended state for this setting is: True (recommended).
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to True (recommended):
    Firewall\Enable Public Network Firewall
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile\\EnableFirewall' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Public Network Firewall: Allow Local Ipsec Policy Merge'' is set to ''False'''
  description: |-
    This setting controls whether local administrators are allowed to create connection
    security rules that apply together with connection security rules configured by Group
    Policy.
    The recommended state for this setting is: False.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to False:
    Firewall\Enable Public Network Firewall: Allow Local Ipsec Policy Merge
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile\\EnableFirewall' AND data = '0';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Public Network Firewall: Allow Local Policy Merge'' is set to ''False'''
  description: |-
    This setting controls whether local administrators are allowed to create local firewall
    rules that apply together with firewall rules configured by Group Policy.
    The recommended state for this setting is: False.
    Note: When the Allow Local Policy Merge setting is configured to False, it's
    recommended to also configure the Disable Inbound Notifications setting to True.
    Otherwise, users will continue to receive messages that ask if they want to unblock a
    restricted inbound connection, but the user's response will be ignored.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to False:
    Firewall\Enable Public Network Firewall: Allow Local Policy Merge
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile\\EnableFirewall' AND data = '0';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Public Network Firewall: Default Inbound Action for Public Profile'' is set to ''Block'''
  description: |-
    This setting determines the behavior for inbound connections that do not match an
    inbound firewall rule.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block:
    Firewall\Enable Public Network Firewall: Default Inbound Action for Public
    Profile
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\Mdm\\PublicProfile\\DefaultInboundAction' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Public Network Firewall: Disable Inbound Notifications'' is set to ''True'''
  description: |-
    Select this option to have Windows Firewall with Advanced Security display notifications
    to the user when a program is blocked from receiving inbound connections.
    The recommended state for this setting is: True.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 'True':
    Firewall\Enable Public Network Firewall: Disable Inbound Notifications
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile\\EnableFirewall' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Public Network Firewall: Enable Log Dropped Packets'' is set to ''Yes: Enable Logging Of Dropped Packets'''
  description: |-
    Use this option to log when Windows Firewall with Advanced Security discards an inbound packet
    for any reason. The log records why and when the packet was dropped. Look for entries with the
    word DROP in the action column of the log.
    The recommended state for this setting is: Yes.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Yes:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Logging Customize\Log dropped packets'
  query: SELECT * FROM registry WHERE (key = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\PublicProfile\\Logging\LogDroppedPackets' and data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Public Network Firewall: Enable Log Success Connections'' is set to ''Enable Logging Of Successful Connections'''
  description: |-
    Use this option to log when Windows Firewall with Advanced Security allows an
    inbound connection. The log records why and when the connection was formed. Look
    for entries with the word ALLOW in the action column of the log.
    The recommended state for this setting is: Enable Logging Of Successful
    Connections.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enable Logging Of Successful Connections.
    Firewall\Enable Public Network Firewall: Enable Log success connections
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile\\EnableFirewall' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Public Network Firewall: Log File Path'' is set to ''%SystemRoot%\System32\logfiles\firewall\publicfw.log'''
  description: |-
    Use this option to specify the path and name of the file in which Windows Firewall will
    write its log information.
    The recommended state for this setting is:
    %SystemRoot%\System32\logfiles\firewall\publicfw.log.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to
    %SystemRoot%\System32\logfiles\firewall\publicfw.log:
    Firewall\Enable Public Network Firewall: Log File Path
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile\\LogFilePath' AND data LIKE '%%systemroot%\\system32\\logfiles\\firewall\\publicfw.log%';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Enable Public Network Firewall: Log Max File Size'' is set to ''16,384 KB or greater'''
  description: |-
    Use this option to specify the size limit of the file in which Windows Firewall will write its
    log information.
    The recommended state for this setting is: 16,384 KB or greater.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 16,384 KB or greater:
    Firewall\Enable Public Network Firewall: Log Max File Size (KB)
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile\\LogFileSize' AND data = '16384';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable insecure guest logons' is set to 'Disabled'
  description: |-
    This policy setting determines if the SMB client will allow insecure guest logons to an SMB server.
    The recommended state for this setting is: Disabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\Network\Lanman Workstation\Enable insecure guest logons'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\LanmanWorkstation\AllowInsecureGuestAuth' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Accounts: Enable Guest account status'' is set to ''Disabled'''
  description: This policy setting determines whether the Guest account is enabled or disabled. The Guest account allows unauthenticated network users to gain access to the system.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Guest account status'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/LocalPoliciesSecurityOptions/Accounts_EnableGuestAccountStatus</LocURI></Target></Item></Get></SyncBody>" and mdm_command_output == 0;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Accounts: Limit local account use of blank passwords to console logon only'' is set to ''Enabled'''
  description: This policy setting determines whether local accounts that are not password protected can be used to log on from locations other than the physical computer console.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Limit local account use of blank passwords to console logon only'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\LimitBlankPasswordUse' AND data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Interactive logon: Do not display last signed-in'' is set to ''Enabled'''
  description: |-
    This policy setting determines whether the account name of the last user to log on to the client
    computers in your organization will be displayed in each computer's respective Windows logon
    screen.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Don't display last signed-in'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\dontdisplaylastusername' AND data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Interactive logon: Do not require CTRL+ALT+DEL'' is set to ''Disabled'''
  description: This policy setting determines whether users must press CTRL+ALT+DEL before they log on.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Do not require CTRL+ALT+DEL'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DisableCAD' AND data == 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Interactive logon: Machine inactivity limit'' is set to ''900 or fewer second(s), but not 0'''
  description: Windows notices inactivity of a logon session, and if the amount of inactive time exceeds the inactivity limit, then the screen saver will run, locking the session.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to '900 or fewer seconds, but not 0':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Machine inactivity limit'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\InactivityTimeoutSecs' AND data <= 900 AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Interactive logon: Smart card removal behavior'' is set to ''Lock Workstation'' or higher'
  description: This policy setting determines what happens when the smart card for a logged-on user is removed from the smart card reader.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the
    following UI path to 'Lock Workstation (or, if applicable for your environment, Force Logoff or Disconnect if a Remote Desktop Services session)':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Smart card removal behavior'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\scremoveoption' AND CAST(data AS INTEGER) >= 1 AND CAST(data AS INTEGER) <= 3);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Microsoft network client: Digitally sign communications (always)'' is set to ''Enabled'''
  description: This policy setting determines whether packet signing is required by the SMB client component.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Microsoft network client: Digitally sign communications (always)'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\CurrentControlSet\\Services\\LanmanWorkstation\\Parameters\\RequireSecuritySignature' AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Microsoft network client: Digitally sign communications (if server agrees)'' is set to ''Enabled'''
  description: This policy setting determines whether the SMB client will attempt to negotiate SMB packet signing.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Microsoft network client: Digitally sign communications (if server agrees)'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\CurrentControlSet\\Services\\LanmanWorkstation\\Parameters\\EnableSecuritySignature' AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Microsoft network client: Send unencrypted password to third-party SMB servers'' is set to ''Disabled'''
  description: This policy setting determines whether the SMB redirector will send plaintext passwords during authentication to third-party SMB servers that do not support password encryption.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Microsoft network client: Send unencrypted password to third-party SMB servers'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\CurrentControlSet\\Services\\LanmanWorkstation\\Parameters\\EnablePlainTextPassword' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Microsoft network server: Digitally sign communications (always)'' is set to ''Enabled'''
  description: |-
    This policy setting determines whether packet signing is required by the SMB server component.
    Enable this policy setting in a mixed environment to prevent downstream clients from using the
    workstation as a network server.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Microsoft network server: Digitally sign communications (always)'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\CurrentControlSet\\Services\\LanManServer\\Parameters\\requiresecuritysignature' AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Microsoft network server: Digitally sign communications (if client agrees)'' is set to ''Enabled'''
  description: This policy setting determines whether the SMB client will attempt to negotiate SMB packet signing.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Microsoft network client: Digitally sign communications (if server agrees)'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\CurrentControlSet\\Services\\LanmanWorkstation\\Parameters\\EnableSecuritySignature' AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Network access: Do not allow anonymous enumeration of SAM accounts'' is set to ''Enabled'''
  description: |-
    This policy setting controls the ability of anonymous users to enumerate the accounts in
    the Security Accounts Manager (SAM). If you enable this policy setting, users with
    anonymous connections will not be able to enumerate domain account user names on the
    systems in your environment. This policy setting also allows additional restrictions on
    anonymous connections.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Network access: Do not allow anonymous enumeration of SAM accounts'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\restrictanonymoussam' AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Network access: Do not allow anonymous enumeration of SAM accounts and shares'' is set to ''Enabled'''
  description: |-
    This policy setting controls the ability of anonymous users to enumerate SAM accounts as
    well as shares. If you enable this policy setting, anonymous users will not be able to
    enumerate domain account user names and network share names on the systems in your
    environment.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Network access: Do not allow anonymous enumeration of SAM accounts and shares'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\restrictanonymous' AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Network access: Restrict anonymous access to Named Pipes and Shares'' is set to ''Enabled'''
  description: |-
    When enabled, this policy setting restricts anonymous access to only those shares and
    pipes that are named in the Network access: Named pipes that can be accessed
    anonymously and Network access: Shares that can be accessed anonymously settings.
    This policy setting controls null session access to shares on your computers by adding
    RestrictNullSessAccess with the value 1 in the
    HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters
    registry key. This registry value toggles null session shares on or off to control whether the
    server service restricts unauthenticated clients' access to named resources.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Network access: Restrict anonymous access to Named Pipes and Shares'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanManServer\\Parameters\restrictnullsessaccess' and data == '1');
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Network access: Restrict clients allowed to make remote calls to SAM'' is set to ''Administrators: Remote Access: Allow'''
  description: This policy setting allows you to restrict remote RPC connections to SAM.
  resolution: To establish the recommended configuration via GP, set the following UI path to
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\RestrictRemoteSAM' and (data == '' or data == 'O:BAG:BAD:'));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Network security: Allow Local System to use computer identity for NTLM'' is set to ''Allow'''
  description: This policy setting determines whether Local System services that use Negotiate when reverting to NTLM authentication can use the computer identity.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Network security: Allow Local System to use computer identity for NTLM'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\UseMachineId' COLLATE NOCASE AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Network Security: Allow PKU2U authentication requests'' is set to ''Block'''
  description: |-
    This setting determines if online identities are able to authenticate to this computer.
    The Public Key Cryptography Based User-to-User (PKU2U) protocol introduced in
    Windows 7 and Windows Server 2008 R2 is implemented as a security support provider
    (SSP). The SSP enables peer-to-peer authentication, particularly through the Windows
    7 media and file sharing feature called HomeGroup, which permits sharing between
    computers that are not members of a domain.
    With PKU2U, a new extension was introduced to the Negotiate authentication package,
    Spnego.dll. In previous versions of Windows, Negotiate decided whether to use
    Kerberos or NTLM for authentication. The extension SSP for Negotiate, Negoexts.dll,
    which is treated as an authentication protocol by Windows, supports Microsoft SSPs
    including PKU2U.
    When computers are configured to accept authentication requests by using online IDs,
    Negoexts.dll calls the PKU2U SSP on the computer that is used to log on. The
    PKU2U SSP obtains a local certificate and exchanges the policy between the peer
    computers. When validated on the peer computer, the certificate within the metadata is
    sent to the logon peer for validation and associates the user's certificate to a security
    token and the logon process completes.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block:
    Local Policies Security Options\Network Security: Allow PKU2U authentication
    requests to this computer
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\pku2u\\AllowOnlineID' COLLATE NOCASE AND data == 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Network security: Do not store LAN Manager hash value on next password change'' is set to ''Enabled'''
  description: |-
    This policy setting determines whether the LAN Manager (LM) hash value for the new password is
    stored when the password is changed. The LM hash is relatively weak and prone to attack compared
    to the cryptographically stronger Microsoft Windows NT hash. Since LM hashes are stored on the
    local computer in the security database, passwords can then be easily compromised if the
    database is attacked.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Network security: Do not store LAN Manager hash value on next password change'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\NoLmHash' COLLATE NOCASE AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Network security: LAN Manager authentication level'' is set to ''Send LM and NTLMv2 responses only. Refuse LM and NTLM'''
  description: |-
    LAN Manager (LM) was a family of early Microsoft client/server software (predating Windows NT)
    that allowed users to link personal computers together on a single network. LM network
    capabilities included transparent file and print sharing, user security features, and network
    administration tools. In Active Directory domains, the Kerberos protocol is the default
    authentication protocol.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Send NTLMv2 response only. Refuse LM & NTLM':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Network security: LAN Manager authentication level'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\LmCompatibilityLevel' COLLATE NOCASE AND data == 5);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Network Security Minimum Session Security For NTLMSSP Based Clients' is set to 'Require NTLM and 128-bit encryption'
  description: |-
    This policy setting determines which behaviors are allowed by clients for applications
    using the NTLM Security Support Provider (SSP). The SSP Interface (SSPI) is used by
    applications that need authentication services. The setting does not modify how the
    authentication sequence works but instead require certain behaviors in applications that
    use the SSPI.
    The recommended state for this setting is: Require NTLM and 128-bit encryption.
    Note: These values are dependent on the Network security: LAN Manager
    Authentication Level security setting value.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Require NTLM and 128-bit encryption:
    Local Policies Security Options\Network security: Minimum session security
    for NTLM SSP based (including secure RPC) clients
  query: |-
    SELECT 1 FROM registry WHERE
      (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\MSV1_0\\NTLMMinClientSec'
       AND data == 537395200);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Network Security Minimum Session Security For NTLMSSP Based Servers' is set to 'Require NTLM and 128bit encryption'
  description: |-
    This policy setting determines which behaviors are allowed by servers for applications
    using the NTLM Security Support Provider (SSP). The SSP Interface (SSPI) is used by
    applications that need authentication services. The setting does not modify how the
    authentication sequence works but instead require certain behaviors in applications that
    use the SSPI.
    The recommended state for this setting is: Require NTLM and 128-bit encryption.
    Note: These values are dependent on the Network security: LAN Manager
    Authentication Level security setting value.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Require NTLM and 128-bit encryption:
    Local Policies Security Options\Network security: Minimum session security
    for NTLM SSP based (including secure RPC) servers
  query: |-
    SELECT 1 FROM registry WHERE
      (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\MSV1_0\\NTLMMinServerSec'
       AND data == 537395200);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Network security: Restrict NTLM: Audit Incoming NTLM Traffic'' is set to ''Enable auditing for all accounts'''
  description: |-
    This policy setting allows the auditing of incoming NTLM traffic. Events for this setting are recorded in the operational event log (e.g. Applications and Services Log\Microsoft\Windows\NTLM).
    The recommended state for this setting is: Enable auditing for all accounts.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enable auditing for all accounts:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Network security: Restrict NTLM: Audit Incoming NTLM Traffic'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0\AuditReceivingNTLMTraffic' AND data = 2);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''User Account Control: Behavior of the elevation prompt for administrators'' is set to ''Prompt for consent on the secure desktop'' or higher'
  description: |-
    This policy setting controls the behavior of the elevation prompt for administrators.
    The recommended state for this setting is: Prompt for consent on the secure desktop.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Prompt for consent on the secure desktop':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\User Account Control: Behavior of the elevation prompt for administrators in Admin Approval Mode'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\ConsentPromptBehaviorAdmin' AND data == 2);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''User Account Control: Behavior of the elevation prompt for standard users'' is set to ''Automatically deny elevation requests'''
  description: |-
    This policy setting controls the behavior of the elevation prompt for standard users.
    The recommended state for this setting is: Automatically deny elevation requests.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Automatically deny elevation requests:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\User Account Control: Behavior of the elevation prompt for standard users'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\ConsentPromptBehaviorUser' AND data == 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''User Account Control: Detect application installations and prompt for elevation'' is set to ''Enabled'''
  description: |-
    This policy setting controls the behavior of application installation detection for the computer.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\User Account Control: Detect application installations and prompt for elevation'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\EnableInstallerDetection' and data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''User Account Control: Only elevate UIAccess applications that are installed in secure locations'' is set to ''Enabled'''
  description: |-
    This policy setting controls whether applications that request to run with a User Interface Accessibility (UIAccess) integrity level must reside in a secure location in the file system. Secure locations are limited to the following:
    ...\Program Files\, including subfolders
    ...\Windows\System32\
    ...\Program Files (x86)\, including subfolders (for 64-bit versions of Windows)
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\User Account Control: Only elevate UIAccess applications that are installed in secure locations'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\EnableSecureUIAPaths' and data == '1');
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''User Account Control: Use Admin Approval Mode'' is set to ''Enabled'''
  description: |-
    This policy setting controls the behavior of Admin Approval Mode for the built-in Administrator account.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\User Account Control: Admin Approval Mode for the Built-in Administrator account'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\FilterAdministratorToken' AND data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''User Account Control: Switch to the secure desktop when prompting for elevation'' is set to ''Enabled'''
  description: |-
    This policy setting controls whether the elevation request prompt is displayed on the interactive user's desktop or the secure desktop.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\User Account Control: Switch to the secure desktop when prompting for elevation'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\PromptOnSecureDesktop' and data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''User Account Control: Run all administrators in Admin Approval Mode'' is set to ''Enabled'''
  description: |-
    This policy setting controls the behavior of all User Account Control (UAC) policy settings for the computer. If you change this policy setting, you must restart your computer.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\User Account Control: Run all administrators in Admin Approval Mode'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\EnableLUA' and data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''User Account Control: Virtualize file and registry write failures to per-user locations'' is set to ''Enabled'''
  description: |-
    This policy setting controls whether application write failures are redirected to defined registry and file system locations. This policy setting mitigates applications that run as administrator and write run-time application data to:
    %ProgramFiles%
    %windir%
    %windir%\System32
    HKEY_LOCAL_MACHINE\SOFTWARE
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\User Account Control: Virtualize file and registry write failures to per-user locations'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\EnableVirtualization' and data == 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Configure Lsa Protected Process is set to 'Enabled with UEFI Lock...'
  description: |-
    This policy setting controls whether the Local Security Authority Subservice Service
    (LSASS) runs in protected mode and also has the option to lock in protected mode with
    Unified Extensible Firmware Interface (UEFI). The Local Security Authority (LSA), which
    includes the LSASS process, validates users for local and remote sign-ins and enforces
    local security policies.
    The recommended state for this setting is: Enabled with UEFI lock. LSA will run
    as protected process and this configuration is UEFI locked.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled with UEFI lock....
    Local Security Authority\Configure Lsa Protected Process
  query: |-
    SELECT 1 FROM registry WHERE
      (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\RunAsPPL'
       AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow apps from the Microsoft app store to auto update' is set to 'Allowed'
  description: |-
    This setting enables or disables the automatic download and installation of Microsoft
    Store app updates.
    The recommended state for this setting is: Allowed.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Allowed:
    Microsoft App Store\Allow apps from the Microsoft app store to auto update
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\WindowsStore\\AutoDownload' AND data = '2';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Game DVR' is set to 'Block'
  description: |-
    This setting enables or disables the Windows Game Recording and Broadcasting
    features.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block:
    Microsoft App Store\Allow Game DVR
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\GameDVR\\AllowGameDVR' AND data = '0';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Block Non Admin User Install' is set to 'Allow'
  description: |-
    This setting manages non-Administrator users' ability to install Windows app packages.
    The recommended state for this setting is: Allow.
    Warning: If the Self Service Password Reset (SSPR) feature is used in Microsoft Entra
    ID, an exception to this recommendation is needed as it's known to interfere with SSPR.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Allow.
    Microsoft App Store\Block Non Admin User Install
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer\\DisableMSI' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'MSI Allow user control over installs' is set to 'Disabled'
  description: This setting controls whether users are permitted to change installation options that typically are available only to system administrators. The security features of Windows Installer normally prevent users from changing installation options that are typically reserved for system administrators, such as specifying the directory to which files are installed. If Windows Installer detects that an installation package has permitted the user to change a protected option, it stops the installation and displays a message. These security features operate only when the installation program is running in a privileged security context in which it has access to directories denied to the user.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Installer\Allow user control over installs'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer\EnableUserControl' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'MSI Always install with elevated privileges' is set to 'Disabled'
  description: This setting controls whether or not Windows Installer should use system permissions when it installs any program on the system.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Installer\Always install with elevated privileges'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer\AlwaysInstallElevated' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'MSI Always install with elevated privileges (User)' is set to 'Disabled'
  description: This setting controls whether or not Windows Installer should use system permissions when it installs any program on the system.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'User Configuration\Policies\Administrative Templates\Windows Components\Windows Installer\Always install with elevated privileges'
  query: SELECT 1 FROM registry WHERE (path LIKE 'HKEY_USERS\%\Software\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Input Personalization' is set to 'Block'
  description: |-
    This policy enables the automatic learning component of input personalization that
    includes speech, inking, and typing. Automatic learning enables the collection of speech
    and handwriting patterns, typing history, contacts, and recent calendar information. It is
    required for the use of Cortana. Some of this collected information may be stored on the
    user's OneDrive, in the case of inking and typing; some of the information will be
    uploaded to Microsoft to personalize speech.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block:
    Privacy\Allow Input Personalization
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\InputPersonalization\\AllowInputPersonalization' AND data = '0';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Let Apps Activate With Voice Above Lock'' is set to ''Enabled: Force Deny'''
  description: |-
    This policy setting specifies whether Windows apps can be activated by voice (apps and
    Cortana) while the system is locked.
    The recommended state for this setting is: Enabled: Force Deny.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled: Force Deny:
    Privacy\Let Apps Activate With Voice Above Lock
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Windows Search\\AllowCortanaAboveLock' AND data = '0';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Indexing Encrypted Stores Or Items' is set to 'Block'
  description: |-
    This policy setting controls whether encrypted items are allowed to be indexed. When
    this setting is changed, the index is rebuilt completely. Full volume encryption (such as
    BitLocker Drive Encryption or a non-Microsoft solution) must be used for the location of
    the index to maintain security for encrypted files.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block:
    Search\Allow Indexing Encrypted Stores Or Items
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Windows Search\\AllowIndexingEncryptedStoresOrItems' AND data = '0';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Search To Use Location' is set to 'Block'
  description: |-
    This policy setting specifies whether search and Cortana can provide location aware
    search and Cortana results.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block:
    Search\Allow search to use location
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Windows Search\\AllowSearchToUseLocation' AND data = '0';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Notify Malicious' is set to 'Enabled'
  description: 'This policy setting determines whether Enhanced Phishing Protection in Microsoft Defender SmartScreen warns users if they type their work or school password into one of the following malicious scenarios: into a reported phishing site, into a Microsoft login URL with an invalid certificate, or into an application connecting to either a reported phishing site or a Microsoft login URL with an invalid certificate. The recommended state for this setting is: Enabled.'
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Defender SmartScreen\Enhanced Phishing Protection\Notify Malicious'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WTDS\\Components\\NotifyMalicious' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Notify Password Reuse' is set to 'Enabled'
  description: |-
    This policy setting determines whether Enhanced Phishing Protection in Microsoft Defender SmartScreen warns users if they reuse their work or school password.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Defender SmartScreen\Enhanced Phishing Protection\Notify Password Reuse'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WTDS\\Components\\NotifyPasswordReuse' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Notify Unsafe App' is set to 'Enabled'
  description: |-
    This policy setting determines whether Enhanced Phishing Protection in Microsoft Defender SmartScreen warns users if they type their work or school passwords in Notepad, WordPad, or M365 Office apps like OneNote, Word, Excel, etc.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Defender SmartScreen\Enhanced Phishing Protection\Notify Unsafe App'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WTDS\\Components\\NotifyUnsafeApp' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Service Enabled' is set to 'Enabled'
  description: |-
    This policy setting determines whether Enhanced Phishing Protection is in audit mode. This allows notifications to be sent to users regarding unsafe password events. Additionally, Enhanced Phishing Protection captures unsafe password entry events and sends diagnostic data through Microsoft Defender.
    The recommended state for this setting is: Enabled.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Defender SmartScreen\Enhanced Phishing Protection\Service Enabled'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WTDS\\Components\\ServiceEnabled' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable Sudo' is set to 'Sudo is disabled'
  description: |-
    This policy setting configures the use of the sudo.exe command line tool. The sudo
    feature in Windows allows users to run elevated commands (as an administrator)
    directly from an unelevated console session.
    The recommended state for this setting is: Sudo is disabled.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Sudo is disabled.
    Sudo\Enable Sudo
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Sudo\\EnableSudo' AND data = '0';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Telemetry' is set to 'Basic'
  description: |-
    This policy setting determines the amount of diagnostic and usage data reported to
    Microsoft:
    The recommended state for this setting is: Basic or Security.
    Note: If your organization relies on Windows Update, the minimum recommended
    setting is Required diagnostic data. Because no Windows Update information is
    collected when diagnostic data is off, important information about update failures is not
    sent. Microsoft uses this information to fix the causes of those failures and improve the
    quality of updates.
    Note #2: The Configure diagnostic data opt-in settings user interface group policy can
    be used to prevent end users from changing their data collection settings.
    Note #3: Enhanced diagnostic data setting is not available on Windows 11 and
    Windows Server 2022 and has been replaced with policies that can control the amount
    of optional diagnostic data that is sent. For more information on these settings visit
    Manage diagnostic data using Group Policy and MDM
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Basic or Security:
    System\Allow Telemetry
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection\\AllowTelemetry' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable OneSettings Auditing' is set to 'Enabled'
  description: |-
    This policy is meant for Windows 11.
    This policy setting controls whether Windows records attempts to connect with the OneSettings service to the Operational EventLog.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Data Collection and Preview Builds\Enable OneSettings Auditing'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection\\EnableOneSettingsAuditing' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Limit Diagnostic Log Collection' is set to 'Enabled'
  description: |-
    This policy is meant for Windows 11.
    This policy setting controls whether additional diagnostic logs are collected when more information is needed to troubleshoot a problem on the device.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Data Collection and Preview Builds\Limit Diagnostic Log Collection'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection\\LimitDiagnosticLogCollection' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Limit Dump Collection' is set to 'Enabled'
  description: |-
    This policy is meant for Windows 11.
    This policy setting limits the type of dumps that can be collected when more information is needed to troubleshoot a problem.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled.
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Data Collection and Preview Builds\Limit Dump Collection'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\DataCollection\LimitDumpCollection' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Computer Browser (Browser)' is set to 'Disabled' or 'Not Installed'
  description: |-
    Maintains an updated list of computers on the network and supplies this list to computers designated as browsers.
    The recommended state for this setting is: Disabled or Not Installed.
  resolution: ""
  query: |-
    SELECT 1 WHERE
    NOT EXISTS ( SELECT 1 FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Browser\\Start' )
    OR
    EXISTS ( SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Browser\\Start' AND data == 4 );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'IIS Admin Service (IISADMIN)' is set to 'Disabled' or 'Not Installed'
  description: |-
    Enables the server to administer the IIS metabase. The IIS metabase stores configuration for the SMTP and FTP services.
    The recommended state for this setting is: Disabled or Not Installed.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to Disabled or Not Installed.:
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\IIS Admin Service'
  query: |-
    SELECT 1 WHERE
    NOT EXISTS ( SELECT 1 FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\IISADMIN\\Start' )
    OR
    EXISTS ( SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\IISADMIN\\Start' AND data == 4 );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Infrared monitor service (irmon)' is set to 'Disabled' or 'Not Installed'
  description: |-
    Detects other Infrared devices that are in range and launches the file transfer application.
    The recommended state for this setting is: Disabled or Not Installed.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to Disabled or Not Installed.:
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Infrared monitor service'
  query: |-
    SELECT 1 WHERE
    NOT EXISTS ( SELECT 1 FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\irmon\\Start' )
    OR
    EXISTS ( SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\irmon\\Start' AND data == 4 );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'LxssManager (LxssManager)' is set to 'Disabled' or 'Not Installed'
  description: |-
    The LXSS Manager service supports running native ELF binaries. The service provides the infrastructure necessary for ELF binaries to run on Windows.
    The recommended state for this setting is: Disabled or Not Installed.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to Disabled or Not Installed.:
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\LxssManager'
  query: |-
    SELECT 1 WHERE
    NOT EXISTS ( SELECT 1 FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\LxssManager\\Start' )
    OR
    EXISTS ( SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LxssManager\\Start' AND data == 4 );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Microsoft FTP Service (FTPSVC)' is set to 'Disabled' or 'Not Installed'
  description: |-
    Enables the server to be a File Transfer Protocol (FTP) server.
    The recommended state for this setting is: Disabled or Not Installed.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to Disabled or Not Installed.:
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Microsoft FTP Service'
  query: |-
    SELECT 1 WHERE
    NOT EXISTS ( SELECT 1 FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\FTPSVC\\Start' )
    OR
    EXISTS ( SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\FTPSVC\\Start' AND data == 4 );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'OpenSSH SSH Server (sshd)' is set to 'Disabled' or 'Not Installed'
  description: |-
    SSH protocol based service to provide secure encrypted communications between two untrusted hosts over an insecure network.
    The recommended state for this setting is: Disabled or Not Installed.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to Disabled or Not Installed.:
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\OpenSSH SSH Server'
  query: |-
    SELECT 1 WHERE
    NOT EXISTS ( SELECT 1 FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\sshd\\Start' )
    OR
    EXISTS ( SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\sshd\\Start' AND data == 4 );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Remote Procedure Call (RPC) Locator (RpcLocator)' is set to 'Disabled'
  description: |-
    In Windows 2003 and older versions of Windows, the Remote Procedure Call (RPC) Locator service
    manages the RPC name service database. In Windows Vista and newer versions of Windows, this
    service does not provide any functionality and is present for application compatibility.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Remote Procedure Call (RPC) Locator'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\RpcLocator\\Start' AND data == 4);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Routing and Remote Access (RemoteAccess)' is set to 'Disabled'
  description: The service offers routing services to businesses in local area and wide area network environments.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Routing and Remote Access'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\RemoteAccess\\Start' AND data == 4);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Simple TCP/IP Services (simptcp)' is set to 'Disabled' or 'Not Installed'
  description: 'The service supports the following TCP/IP services: Character Generator, Daytime, Discard, Echo, and Quote of the Day.'
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled' or to 'Not Installed':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Simple TCP/IP Services'
  query: |-
    SELECT CASE
    WHEN NOT EXISTS (SELECT * FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\simptcp\\Start') THEN 1
    WHEN (SELECT data FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\simptcp\\Start') == '4' THEN 1
    ELSE 0
    END AS result;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Special Administration Console Helper (sacsvr)' is set to 'Disabled' or 'Not Installed'
  description: The service allows administrators to remotely access a command prompt using Emergency Management Services.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled' or to 'Not Installed':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Special Administration Console Helper'
  query: |-
    SELECT CASE
    WHEN NOT EXISTS (SELECT * FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\sacsvr\\Start') THEN 1
    WHEN (SELECT data FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\sacsvr\\Start') == '4' THEN 1
    ELSE 0
    END AS result;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'SSDP Discovery (SSDPSRV)' is set to 'Disabled'
  description: |-
    This service discovers networked devices and services that use the SSDP discovery protocol, such
    as UPnP devices. Also announces SSDP devices and services running on the local computer.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\SSDP Discovery'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SSDPSRV\\Start' AND data == 4);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'UPnP Device Host (upnphost)' is set to 'Disabled'
  description: This service allows UPnP devices to be hosted on this computer.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\UPnP Device Host'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\upnphost\\Start' AND data == 4);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Web Management Service (WMSvc)' is set to 'Disabled' or 'Not Installed'
  description: This web management Service enables remote and delegated management capabilities for administrators to manage for the Web server, sites and applications present on the machine.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled' or to 'Not Installed':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Web Management Service'
  query: |-
    SELECT CASE
    WHEN NOT EXISTS (SELECT * FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\WMSvc\\Start') THEN 1
    WHEN (SELECT data FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\WMSvc\\Start') == '4' THEN 1
    ELSE 0
    END AS result;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Windows Media Player Network Sharing Service (WMPNetworkSvc)' is set to 'Disabled' or 'Not Installed'
  description: This service shares Windows Media Player libraries to other networked players and media devices using Universal Plug and Play.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled' or to 'Not Installed':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Windows Media Player Network Sharing Service'
  query: |-
    SELECT CASE
    WHEN NOT EXISTS (SELECT * FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\WMPNetworkSvc\\Start') THEN 1
    WHEN (SELECT data FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\WMPNetworkSvc\\Start') == '4' THEN 1
    ELSE 0
    END AS result;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Windows Mobile Hotspot Service (icssvc)' is set to 'Disabled'
  description: This service provides the ability to share a cellular data connection with another device.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Windows Mobile Hotspot Service'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\icssvc\\Start' AND data == 4);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'World Wide Web Publishing Service (W3SVC)' is set to 'Disabled' or 'Not Installed'
  description: This service provides Web connectivity and administration through the Internet Information Services Manager.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled' or to 'Not Installed':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\World Wide Web Publishing Service'
  query: |-
    SELECT CASE
    WHEN NOT EXISTS (SELECT * FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W3SVC\\Start') THEN 1
    WHEN (SELECT data FROM registry WHERE key = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W3SVC\\Start') == '4' THEN 1
    ELSE 0
    END AS result;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Xbox Accessory Management Service (XboxGipSvc)' is set to 'Disabled'
  description: This service manages connected Xbox accessories.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Xbox Accessory Management Service'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\XboxGipSvc\\Start' AND data == 4);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Xbox Live Auth Manager (XblAuthManager)' is set to 'Disabled'
  description: This service provides authentication and authorization services for interacting with Xbox Live.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Xbox Live Auth Manager'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\XblAuthManager\\Start' AND data == 4);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Xbox Live Game Save (XblGameSave)' is set to 'Disabled'
  description: This service syncs save data for Xbox Live save enabled game.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Xbox Live Game Save'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\XblGameSave\\Start' AND data == 4);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Xbox Live Networking Service (XboxNetApiSvc)' is set to 'Disabled'
  description: This service supports the Windows.Networking.XboxLive application programming interface.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via domain GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Xbox Live Networking Service'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\XboxNetApiSvc\\Start' AND data == 4);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Access Credential Manager As Trusted Caller' is set to 'No One'
  description: |-
    This security setting is used by Credential Manager during Backup and Restore. No accounts should have this user right, as it is only assigned to Winlogon. Users' saved credentials might be compromised if this user right is assigned to other entities.
    The recommended state for this setting is: No One.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to an empty list of users:
    'Computer Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Access Credential Manager as a trusted caller'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/AccessCredentialManagerAsTrustedCaller</LocURI></Target></Item></Get></SyncBody>"
    AND mdm_command_output = "";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Access From Network' is set to 'Administrators, Remote Desktop Users'
  description: |-
    This policy setting allows other users on the network to connect to the computer and is required by various network protocols that include Server Message Block (SMB)-based protocols, NetBIOS, Common Internet File System (CIFS), and Component Object Model Plus (COM+).
    The recommended state for this setting is: Administrators, Remote Desktop Users.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to a list containing only 'Administrators' and 'Remote Desktop Users':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Access this computer from the network'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/AccessFromNetwork</LocURI></Target></Item></Get></SyncBody>"
    AND mdm_command_output  LIKE "Administrators_REMOTE INTERACTIVE LOGON";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Act As Part Of The Operating System' is set to 'No One'
  description: |-
    This policy setting allows a process to assume the identity of any user and thus gain access to the resources that the user is authorized to access.
    The recommended state for this setting is: No One.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to an empty list of users:
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Act as part of the operating system'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Config/UserRights/ActAsPartOfTheOperatingSystem</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output = "";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Local Log On' is set to 'Administrators, Users'
  description: |-
    This policy setting determines which users can interactively log on to computers in your environment. Logons that are initiated by pressing the CTRL+ALT+DEL key sequence on the client computer keyboard require this user right. Users who attempt to log on through Terminal Services / Remote Desktop Services or IIS also require this user right.
    The recommended state for this setting is: Administrators, Users.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to a list containing only 'Administrators' and 'Users':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Allow log on locally'
  query: |-
    SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/AllowLocalLogOn</LocURI></Target></Item></Get></SyncBody>"
    AND
    (
    mdm_command_output LIKE "Administrators_Users"
    OR
    mdm_command_output LIKE "Users_Administrators"
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Backup Files And Directories' is set to 'Administrators'
  description: |-
    This policy setting allows users to circumvent file and directory permissions to back up the system. This user right is enabled only when an application (such as NTBACKUP) attempts to access a file or directory through the NTFS file system backup application programming interface (API). Otherwise, the assigned file and directory permissions apply.
    The recommended state for this setting is: Administrators.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to a list containing only 'Administrators':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Back up files and directories'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/BackupFilesAndDirectories</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output = "Administrators";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Change System Time' is set to 'Administrators, LOCAL SERVICE'
  description: |-
    This policy setting determines which users and groups can change the time and date on the
    internal clock of the computers in your environment. Users who are assigned this user right can
    affect the appearance of event logs. When a computer's time setting is changed, logged events
    reflect the new time, not the actual time that the events occurred.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Administrators, LOCAL SERVICE':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Change the system time'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/ChangeSystemTime</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output LIKE "Administrators%" AND mdm_command_output LIKE "%LOCAL SERVICE";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Create Global Objects' is set to 'Administrators, LOCAL SERVICE, NETWORK SERVICE, SERVICE'
  description: This policy setting allows users to change the size of the pagefile. By making the pagefile extremely large or extremely small, an attacker could easily affect the performance of a compromised computer.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Administrators, LOCAL SERVICE, NETWORK SERVICE, SERVICE':
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Create global objects'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/CreateGlobalObjects</LocURI></Target></Item></Get></SyncBody>" AND (regex_match(mdm_command_output,".*(Administrators|LOCAL SERVICE|NETWORK SERVICE|([^\w\s]SERVICE)).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Create Page File' is set to 'Administrators'
  description: |-
    This policy setting allows users to change the size of the pagefile. By making the
    pagefile extremely large or extremely small, an attacker could easily affect the
    performance of a compromised computer.
    The recommended state for this setting is: *S-1-5-32-544 (Administrators).
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to *S-1-5-32-544 (Administrators).
    User Rights\Create Page File

    Note: Include only one User or Group per line in the Settings Catalog configuration
    screen.
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/CreatePageFile</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output = "Administrators";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Create Permanent Shared Objects' is set to 'No One'
  description: |-
    This user right is useful to kernel-mode components that extend the object namespace.
    However, components that run in kernel mode have this user right inherently. Therefore,
    it is typically not necessary to specifically assign this user right.
    The recommended state for this setting is: No One.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to (<![CDATA[]]>) which equals No One.
    User Rights\Create Permanent Shared Objects

    Note: Using (<![CDATA[]]>) to represent a blank value or No One is recommended
    by Microsoft. However, there is a known issue where an error occurs in Endpoint
    Manger (Intune) but does not affect the policy setting from being applied to the system
    properly.
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/CreatePermanentSharedObjects</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Create Symbolic Links' is set to 'Administrators'
  description: |-
    This policy setting determines which users can create symbolic links. In Windows Vista,
    existing NTFS file system objects, such as files and folders, can be accessed by
    referring to a new kind of file system object called a symbolic link. A symbolic link is a
    pointer (much like a shortcut or .lnk file) to another file system object, which can be a
    file, folder, shortcut or another symbolic link. The difference between a shortcut and a
    symbolic link is that a shortcut only works from within the Windows shell. To other
    programs and applications, shortcuts are just another file, whereas with symbolic links,
    the concept of a shortcut is implemented as a feature of the NTFS file system.
    Symbolic links can potentially expose security vulnerabilities in applications that are not
    designed to use them. For this reason, the privilege for creating symbolic links should
    only be assigned to trusted users. By default, only Administrators can create
    symbolic links.
    The recommended state for this setting is: *S-1-5-32-544 (Administrators) and (when
    the Hyper-V feature is installed) *S-1-5-83-0 (NT VIRTUAL MACHINE\Virtual
    Machines).
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to *S-1-5-32-544 (Administrators) and optionally *S-1-5-83-0
    (NT VIRTUAL MACHINE\Virtual Machines)
    User Rights\Create Symbolic Links

    Note: Include only one User or Group per line in the Settings Catalog configuration
    screen.
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/CreateSymbolicLinks</LocURI></Target></Item></Get></SyncBody>" AND (regex_match(mdm_command_output,".*(Administrators|Virtual Machines).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Create Token' is set to 'No One'
  description: |-
    This policy setting allows a process to create an access token, which may provide
    elevated rights to access sensitive data.
    The recommended state for this setting is: No One.
    Note: This user right is considered a "sensitive privilege" for the purposes of auditing.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to (<![CDATA[]]>) which equals No One.
    User Rights\Create Token

    Note: Using (<![CDATA[]]>) to represent a blank value or No One is recommended
    by Microsoft. However, there is a known issue where an error occurs in Endpoint
    Manger (Intune) but does not affect the policy setting from being applied to the system
    properly.
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/CreateToken</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Debug Programs' is set to 'Administrators'
  description: |-
    This policy setting determines which user accounts will have the right to attach a debugger to
    any process or to the kernel, which provides complete access to sensitive and critical operating
    system components. Developers who are debugging their own applications do not need to be
    assigned this user right; however, developers who are debugging new system components will need it.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, set the following UI path to 'Administrators'
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Debug programs'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/DebugPrograms</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "Administrators";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Deny Access From Network' to include 'Guests, Local account'
  description: |-
    This policy setting prohibits users from connecting to a computer from across the
    network, which would allow users to access and potentially modify data remotely. In
    high security environments, there should be no need for remote users to access data on
    a computer. Instead, file sharing should be accomplished through the use of network
    servers. This user right supersedes the Access Computer From Network user right if
    an account is subject to both policies.
    The recommended state for this setting is to include: *S-1-5-32-546 and *S-1-5-113
    (Guests, Local account).
    Caution: Configuring a standalone (non-domain-joined) workstation as described above
    may result in an inability to remotely administer the workstation.
    Note: The security identifier Local account is not available in Windows 7 and
    Windows 8.0 unless MSKB 2871997 has been installed.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to *S-1-5-32-546 and *S-1-5-113 (Guests, Local account).
    User Rights\Deny Access From Network

    Note: Include only one User or Group per line in the Settings Catalog configuration
    screen.
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/DenyAccessFromNetwork</LocURI></Target></Item></Get></SyncBody>" AND (regex_match(mdm_command_output,".*(Guests|Local account).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Deny Local Log On' to include 'Guests'
  description: |-
    This security setting determines which users are prevented from logging on at the
    computer. This policy setting supersedes the Allow log on locally policy setting if an
    account is subject to both policies.
    The recommended state for this setting is to include: *S-1-5-32-546 (Guests).
    Important: If you apply this security policy to the Everyone group, no one will be able to
    log on locally.
    Warning: The help text in Intune associated with this recommendation is for the setting,
    Deny log on as a service and not this setting.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to *S-1-5-32-546 (Guests).
    User Rights\Deny Local Log On

    Note: Include only one User or Group per line in the Settings Catalog configuration
    screen.
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/DenyLocalLogOn</LocURI></Target></Item></Get></SyncBody>" AND (regex_match(mdm_command_output,".*(Guest).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Deny Log On As Batch Job' to include 'Guests'
  description: |-
    This policy setting determines which accounts will not be able to log on to the computer as a
    batch job. A batch job is not a batch (.bat) file, but rather a batch-queue facility. Accounts that use the Task Scheduler to schedule jobs need this user right.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, ensure that the following UI path includes 'Guests'
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Deny log on as a batch job'
  query: SELECT 1 FROM cis_audit where item = "2.2.17" AND (regex_match(value,".*(?=.*Guests).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Deny Log On As Service Job' to include 'Guests'
  description: |-
    This security setting determines which service accounts are prevented from registering
    a process as a service. This user right supersedes the Log on as a service user right if
    an account is subject to both policies.
    The recommended state for this setting is to include: *S-1-5-32-546 (Guests).
    Note: This security setting does not apply to the System, Local Service, or Network
    Service accounts.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to *S-1-5-32-546 (Guests).
    User Rights\Deny Log On As Service Job
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/DenyLogOnAsServiceJob</LocURI></Target></Item></Get></SyncBody>" AND (regex_match(mdm_command_output,".*(Guest).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Deny Remote Desktop Services Log On' to include 'Guests, Local account'
  description: |-
    This policy setting determines whether users can log on as Remote Desktop clients.
    After the baseline workstation is joined to a domain environment, there is no need to
    use local accounts to access the workstation from the network. Domain accounts can
    access the workstation for administration and end-user processing. This user right
    supersedes the Allow log on through Remote Desktop Services user right if an
    account is subject to both policies.
    The recommended state for this setting is to include: *S-1-5-32-546 and *S-1-5-113
    (Guests, Local account).
    Caution: Configuring a standalone (non-domain-joined) workstation as described above
    may result in an inability to remotely administer the workstation.
    Caution #2: Configuring a cloud system workstation as described above may result in
    an inability log on to the workstation. In this case, Local Accounts need this ability for
    the log on to succeed.
    Note: The security identifier Local account is not available in Windows 7 and
    Windows 8.0 unless MSKB 2871997 has been installed.
    Note #2: In all versions of Windows prior to Windows 7, Remote Desktop Services
    was known as Terminal Services, so you should substitute the older term if comparing
    against an older OS.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to *S-1-5-32-546 and *S-1-5-113 (Guests, Local account).
    User Rights\Deny Remote Desktop Services Log On

    Note: Include only one User or Group per line in the Settings Catalog configuration
    screen.
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/DenyRemoteDesktopServicesLogOn</LocURI></Target></Item></Get></SyncBody>" AND (regex_match(mdm_command_output,".*(Guests|Local account).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable Delegation' is set to 'No One'
  description: |-
    This policy setting allows users to change the Trusted for Delegation setting on a
    computer object in Active Directory. Abuse of this privilege could allow unauthorized
    users to impersonate other users on the network.
    The recommended state for this setting is: No One.
    Note: This user right is considered a "sensitive privilege" for the purposes of auditing.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to (<![CDATA[]]>) which equals No One.
    User Rights\Enable Delegation

    Note: Using (<![CDATA[]]>) to represent a blank value or No One is recommended
    by Microsoft. However, there is a known issue where an error occurs in Endpoint
    Manger (Intune) but does not affect the policy setting from being applied to the system
    properly.
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/EnableDelegation</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Generate Security Audits' is set to 'LOCAL SERVICE, NETWORK SERVICE'
  description: This policy setting determines which users or processes can generate audit records in the Security log.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, ensure that the following UI path is set to an empty list
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Generate security audits'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/GenerateSecurityAudits</LocURI></Target></Item></Get></SyncBody>" AND (regex_match(mdm_command_output,".*(LOCAL SERVICE|NETWORK SERVICE).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Impersonate Client' is set to 'Administrators, LOCAL SERVICE, NETWORK SERVICE, SERVICE'
  description: |-
    The policy setting allows programs that run on behalf of a user to impersonate that user (or
    another specified account) so that they can act on behalf of the user. If this user right is
    required for this kind of impersonation, an unauthorized user will not be able to convince a
    client to connect—for example, by remote procedure call (RPC) or named pipes—to a service that
    they have created to impersonate that client, which could elevate the unauthorized user's permissions to administrative or system levels.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, ensure that the following UI path is set to an empty list
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Impersonate a client after authentication'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/ImpersonateClient</LocURI></Target></Item></Get></SyncBody>" AND (regex_match(mdm_command_output,".*(Administrators|LOCAL SERVICE|NETWORK SERVICE|([^\w\s]SERVICE)).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Increase Scheduling Priority' is set to 'Administrators, Window Manager\Window Manager Group'
  description: |-
    This policy setting determines whether users can increase the base priority class of a process.
    (It is not a privileged operation to increase relative priority within a priority class.) This
    user right is not required by administrative tools that are supplied with the operating system but might be required by software development tools.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, ensure that the following UI path is set to an empty list
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Increase scheduling priority'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/IncreaseSchedulingPriority</LocURI></Target></Item></Get></SyncBody>" AND (regex_match(mdm_command_output,".*(Administrators|Window Manager Group).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Load Unload Device Drivers' is set to 'Administrators'
  description: |-
    This policy setting allows users to dynamically load a new device driver on a system. An
    attacker could potentially use this capability to install malicious code that appears to be a
    device driver. This user right is required for users to add local printers or printer drivers in
    Windows.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, ensure that the following UI path is set to an empty list
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Increase scheduling priority'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/LoadUnloadDeviceDrivers</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "Administrators";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Lock Memory' is set to 'No One'
  description: |-
    This policy setting allows a process to keep data in physical memory, which prevents
    the system from paging the data to virtual memory on disk. If this user right is assigned,
    significant degradation of system performance can occur.
    The recommended state for this setting is: No One.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to (<![CDATA[]]>) which equals No One.
    User Rights\Lock Memory

    Note: Using (<![CDATA[]]>) to represent a blank value or No One is recommended
    by Microsoft. However, there is a known issue where an error occurs in Endpoint
    Manger (Intune) but does not affect the policy setting from being applied to the system
    properly.
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/LockMemory</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Manage auditing and security log' is set to 'Administrators'
  description: This policy setting determines which users can change the auditing options for files and directories and clear the Security log.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, ensure that the following UI path is set to an empty list
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Manage auditing and security log'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/ManageAuditingAndSecurityLog</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "Administrators";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Manage Volume' is set to 'Administrators'
  description: |-
    This policy setting allows users to manage the system's volume or disk configuration,
    which could allow a user to delete a volume and cause data loss as well as a denial-ofservice condition.
    The recommended state for this setting is: *S-1-5-32-544 (Administrators).
    Note: A workstation with Microsoft SQL Server installed will require a special exception
    to this recommendation for the account that runs the SQL Server service to be granted
    this user right.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to *S-1-5-32-544 (Administrators).
    User Rights\Manage Volume

    Note: Include only one User or Group per line in the Settings Catalog configuration
    screen.
    \
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/ManageVolume</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "Administrators";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Modify Firmware Environment' is set to 'Administrators'
  description: |-
    This policy setting allows users to configure the system-wide environment variables that affect
    hardware configuration. This information is typically stored in the Last Known Good
    Configuration. Modification of these values and could lead to a hardware failure that would result in a denial of service condition.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, ensure that the following UI path is set to an empty list
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Modify firmware environment values'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/ModifyFirmwareEnvironment</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "Administrators";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Modify Object Label' is set to 'No One'
  description: |-
    This privilege determines which user accounts can modify the integrity label of objects,
    such as files, registry keys, or processes owned by other users. Processes running
    under a user account can modify the label of an object owned by that user to a lower
    level without this privilege.
    The recommended state for this setting is: No One.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to (<![CDATA[]]>) which equals No One.
    User Rights\Modify Object Label

    Note: Using (<![CDATA[]]>) to represent a blank value or No One is recommended
    by Microsoft. However, there is a known issue where an error occurs in Endpoint
    Manger (Intune) but does not affect the policy setting from being applied to the system
    properly.
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/ModifyObjectLabel</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Profile Single Process' is set to 'Administrators'
  description: |-
    This policy setting determines which users can use tools to monitor the performance of
    non-system processes. Typically, you do not need to configure this user right to use the
    Microsoft Management Console (MMC) Performance snap-in. However, you do need this user right if
    System Monitor is configured to collect data using Windows Management Instrumentation (WMI).
    Restricting the Profile single process user right prevents intruders from gaining additional
    information that could be used to mount an attack on the system.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, ensure that the following UI path is set to an empty list
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Profile single process'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/ProfileSingleProcess</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "Administrators";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Profile System Performance' is set to 'Administrators, NT SERVICE\WdiServiceHost'
  description: |-
    This policy setting allows users to use tools to view the performance of different system
    processes, which could be abused to allow attackers to determine a system's active processes and
    provide insight into the potential attack surface of the computer.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, ensure that the following UI path is set to 'Administrators, NT SERVICE\WdiServiceHost'
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Profile system performance'
  query: SELECT 1 FROM cis_audit where item = "2.2.35" AND (regex_match(value,".*(?=.*Administrators)(?=.*WdiServiceHost).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Remote Shutdown' is set to 'Administrators'
  description: |-
    This policy setting allows users to shut down Windows Vista-based or newer computers
    from remote locations on the network. Anyone who has been assigned this user right
    can cause a denial of service (DoS) condition, which would make the computer
    unavailable to service user requests. Therefore, it is recommended that only highly
    trusted administrators be assigned this user right.
    The recommended state for this setting is: *S-1-5-32-544 (Administrators).
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to *S-1-5-32-544 (Administrators).
    User Rights\Remote Shutdown

    Note: Include only one User or Group per line in the Settings Catalog configuration
    screen.
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/RemoteShutdown</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "Administrators";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Replace Process Level Token' is set to 'LOCAL SERVICE, NETWORK SERVICE'
  description: |-
    This policy setting allows one process or service to start another service or process with a
    different security access token, which can be used to modify the security access token of that sub-process and result in the escalation of privileges.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, ensure that the following UI path is set to 'LOCAL SERVICE, NETWORK SERVICE'
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Replace a process level token'
  query: SELECT 1 FROM cis_audit where item = "2.2.36" AND (regex_match(value,".*(?=.*LOCAL SERVICE)(?=.*NETWORK SERVICE).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Restore Files And Directories' is set to 'Administrators'
  description: |-
    This policy setting determines which users can bypass file, directory, registry, and other
    persistent object permissions when restoring backed up files and directories on computers that
    run Windows Vista (or newer) in your environment. This user right also determines which users
    can set valid security principals as object owners; it is similar to the Back up files and
    directories user right.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, ensure that the following UI path is set to an empty list
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Restore files and directories'
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/RestoreFilesAndDirectories</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "Administrators";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Shut Down The System' is set to 'Administrators, Users'
  description: |-
    This policy setting determines which users who are logged on locally to the computers in your
    environment can shut down the operating system with the Shut Down command. Misuse of this user right can result in a denial of service condition.
  resolution: |-
    Automatic method:
    Ask your system administrator to establish the recommended configuration via GP, ensure that the following UI path is set to 'Administrators, Users'
    'Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Shut down the system'
  query: SELECT 1 FROM cis_audit where item = "2.2.38" AND (regex_match(value,".*(?=.*Administrators)(?=.*Users).*",0) is not null);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Take Ownership' is set to 'Administrators'
  description: |-
    This policy setting allows users to take ownership of files, folders, registry keys,
    processes, or threads. This user right bypasses any permissions that are in place to
    protect objects to give ownership to the specified user.
    The recommended state for this setting is: *S-1-5-32-544 (Administrators).
    Note: This user right is considered a "sensitive privilege" for the purposes of auditing.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to *S-1-5-32-544 (Administrators).
    User Rights\Take Ownership

    Note: Include only one User or Group per line in the Settings Catalog configuration
    screen.
  query: SELECT 1 FROM mdm_bridge where mdm_command_input = "<SyncBody><Get><CmdID>1</CmdID><Item><Target><LocURI>./Device/Vendor/MSFT/Policy/Result/UserRights/TakeOwnership</LocURI></Target></Item></Get></SyncBody>" AND mdm_command_output == "Administrators";
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Hypervisor Enforced Code Integrity' is set to 'Enabled with UEFI lock'
  description: |-
    This setting enables virtualization based protection of Kernel Mode Code Integrity.
    When this is enabled, kernel mode memory protections are enforced and the Code
    Integrity validation path is protected by the Virtualization Based Security feature.
    The recommended state for this setting is: Enabled with UEFI lock.
    Note: Virtualization Based Security requires a 64-bit version of Windows with Secure
    Boot enabled, which in turn requires that Windows was installed with a UEFI BIOS
    configuration, not a Legacy BIOS configuration. In addition, if running Windows on a
    virtual machine, the hardware-assisted CPU virtualization feature (Intel VT-x or AMD-V)
    must be exposed by the host to the guest VM.
    More information on system requirements for this feature can be found at Windows
    Defender Credential Guard Requirements (Windows 10) | Microsoft Docs
    Note #2: Credential Guard and Device Guard are not currently supported when using
    Azure IaaS VMs.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled with UEFI lock.
    Virtualization Based Technology\Hypervisor Enforced Code Integrity
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\HypervisorEnforcedCodeIntegrity' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Require UEFI Memory Attributes Table' is set to 'Require UEFI Memory Attributes Table'
  description: |-
    This option will only enable Virtualization Based Protection of Code Integrity on devices
    with UEFI firmware support for the Memory Attributes Table. Devices without the UEFI
    Memory Attributes Table may have firmware that is incompatible with Virtualization
    Based Protection of Code Integrity which in some cases can lead to crashes or data
    loss or incompatibility with certain plug-in cards. If not setting this option the targeted
    devices should be tested to ensure compatibility.
    The recommended state for this setting is: Require UEFI Memory Attributes Table.
    Note: Virtualization Based Security requires a 64-bit version of Windows with Secure
    Boot enabled, which in turn requires that Windows was installed with a UEFI BIOS
    configuration, not a Legacy BIOS configuration. In addition, if running Windows on a
    virtual machine, the hardware-assisted CPU virtualization feature (Intel VT-x or AMD-V)
    must be exposed by the host to the guest VM.
    More information on system requirements for this feature can be found at Windows
    Defender Credential Guard Requirements (Windows 10) | Microsoft Docs
    Note #2: Credential Guard and Device Guard are not currently supported when using
    Azure IaaS VMs.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Require UEFI Memory Attributes Table.
    Virtualization Based Technology\Require UEFI Memory Attributes Table
  query: SELECT 1 FROM REGISTRY WHERE (PATH = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DeviceGuard\\HVCIMATRequired' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Auto Connect To Wi Fi Sense Hotspots' is set to 'Block'
  description: |-
    This policy setting determines whether users can enable the following WLAN settings:
    "Connect to suggested open hotspots," "Connect to networks shared by my contacts,"
    and "Enable paid services".
    •

    •

    •

    "Connect to suggested open hotspots" enables Windows to automatically
    connect users to open hotspots it knows about by crowdsourcing networks that
    other people using Windows have connected to.
    "Connect to networks shared by my contacts" enables Windows to automatically
    connect to networks that the user's contacts have shared with them, and enables
    users on this device to share networks with their contacts.
    "Enable paid services" enables Windows to temporarily connect to open hotspots
    to determine if paid services are available.

    The recommended state for this setting is: Block.
    Note: These features are also known by the name "Wi-Fi Sense".
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Block.
    Wi-Fi Settings\Allow Auto Connect To Wi Fi Sense Hotspots
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\PolicyManager\\current\\device\\Connectivity\\WiFiSenseAutoConnect' AND data = '0';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow widgets' is set to 'Not allowed'
  description: |-
    This policy setting specifies whether the Widgets feature is allowed on the device. The
    Widgets feature provides information such as, weather, news, sports, stocks, traffic, and
    entertainment (not an inclusive list).
    The recommended state for this setting is: Not allowed.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Not Allowed.
    Widgets\Allow widgets
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Dsh\\AllowNewsAndInterests' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Disallow Exploit Protection Override' is set to '(Enable)'
  description: |-
    This policy setting prevent users from making changes to the Exploit protection settings
    area in the Windows Security settings.
    The recommended state for this setting is: (Enable).
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to (Enable).
    Windows Defender Security Center\Disallow Exploit Protection Override
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\ExploitGuard\\DisallowExploitProtectionOverride' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Enable ESS with Supported Peripherals' is set to 'Enhanced sign-in security will be enabled…'
  description: |-
    Enhanced Sign-in Security isolates Windows Hello biometric (face and fingerprint)
    template data and matching operations to trusted hardware or specified memory
    regions.
    The recommended state for this setting is: ESS will be enabled on systems with
    capable software and hardware, following the existing default behavior
    in Windows. Authentication operations of any peripheral biometric
    device will be blocked and not available for Windows Hello. (default
    and recommended for highest security)..
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enhanced sign-in security will be enabled…:
    Windows Hello For Business\Enable ESS with Supported Peripherals
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Policies\\PassportForWork\\Biometrics\\EnableESSwithSupportedPeripherals' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Facial Features Use Enhanced Anti Spoofing' is set to 'true'
  description: |-
    This policy setting determines whether enhanced anti-spoofing is configured for devices
    which support it.
    The recommended state for this setting is: true.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to true.
    Windows Hello For Business\Facial Features Use Enhanced Anti Spoofing
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\System\\EnableAntiSpoofing' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Minimum PIN Length' is set to '6 more character(s)'
  description: |-
    Minimum PIN length configures the minimum number of characters required for the PIN.
    The lowest number you can configure for this policy setting is 4. The largest number you
    can configure must be less than the number configured in the Maximum PIN length
    policy setting or the number 127, whichever is the lowest.
    The recommended state for this setting is: 6 more character(s).
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to 6 (or more character(s)):
    Windows Hello For Business\Minimum PIN Length
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\PolicyManager\\current\\device\\Passport\\MinPinLength' AND data = '6';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Require Security Device' is set to 'true'
  description: |-
    This policy controls whether a Trusted Platform Module (TPM) is required to provision
    Windows Hello for Business.
    •
    •

    If you enable this policy setting, only devices with a usable TPM provision
    Windows Hello for Business.
    If you disable or don't configure this policy setting, the TPM is still preferred, but
    all devices provision Windows Hello for Business using software if the TPM is
    non-functional or unavailable.

    The recommended state for this setting is: true.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to true:
    Windows Hello For Business\Require Security Device
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\PolicyManager\\current\\device\\DeviceLock\\RequireSecurityDevice' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Allow Windows Ink Workspace'' is set to ''Enabled: but the user can''t access it above the lock screen'' OR ''Disabled'''
  description: This policy setting determines whether Windows Ink items are allowed above the lock screen.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: On, but disallow access above lock' OR 'Enabled: Disabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Ink Workspace\Allow Windows Ink Workspace'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\WindowsInkWorkspace\AllowWindowsInkWorkspace' AND (data = 0 OR data = 1));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Clipboard Redirection' is set to 'Not allowed'
  description: |-
    This policy setting enables or disables clipboard sharing with the Windows Sandbox.
    The recommended state for this setting is: Not allowed.
    Note: The Windows Sandbox feature was first introduced in Windows 10 R1903, and
    allows a temporary "clean install" virtual instance of Windows to be run inside the host,
    for the ostensible purpose of testing applications without making changes to the host.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Not allowed.
    Windows Sandbox\Allow Clipboard Redirection
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\\fDisableClip' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Networking' is set to 'Not allowed'
  description: |-
    This policy setting enables or disables networking in the Windows Sandbox. Networking
    is achieved by creating a virtual switch on the host, and connecting the Windows
    Sandbox to it via a virtual Network Interface Card (NIC).
    The recommended state for this setting is: Not allowed.
    Note: The Windows Sandbox feature was first introduced in Windows 10 R1903, and
    allows a temporary "clean install" virtual instance of Windows to be run inside the host,
    for the ostensible purpose of testing applications without making changes to the host.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Not allowed.
    Windows Sandbox\Allow Networking
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Sandbox\\AllowNetworking' AND data = 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Allow Auto Update' is set to 'Enabled'
  description: |-
    This policy setting specifies whether computers in your environment will receive security
    updates from Windows Update or WSUS. If you configure this policy setting to Enabled,
    the operating system will recognize when a network connection is available and then
    use the network connection to search Windows Update or your designated intranet site
    for updates that apply to them.
    After this this policy setting is set to Enabled, select one of the following options in the
    Configure Automatic Updates Properties dialog box to specify how the service will work:
    •
    •
    •

    2 - Auto install and restart.
    3 - Auto install and restart at a specified time. (Default)
    4 - Auto install and restart without end-user control.

    The recommended state for this setting is: Enabled and never "Turn off automatic
    updates"
    Note: The sub-setting "Allow Auto Update:" has 6 possible values – not all of them are
    valid depending on specific organizational needs, however if feasible we suggest using
    a value of 2, 3, or 4. The only scored requirement is to not turn off automatic
    updates (5).
    Note #2: Organizations that utilize a third--party solution for patching may choose to
    exempt themselves from this recommendation, and instead configure it to Disabled so
    that the native Windows Update mechanism does not interfere with the third--party
    patching process.
    Warning: If option 3 or 4 is not selected, then the ScheduledInstallDay
    recommendation will not take effect and an exception to that recommendation will be
    needed.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to anything other than "Turn off automatic updates".
    Windows Update For Business\Allow Auto Update
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\PolicyManager\\current\\device\\Update\\AllowAutoUpdate' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Defer Feature Updates Period in Days'' is set to ''Enabled: 180 or more days'''
  description: |-
    This policy setting determines when Preview Build or Feature Updates are received.
    Defer Updates This enables devices to defer taking the next Feature Update available
    to your channel for up to 14 days for all the pre-release channels and up to 365 days for
    the Semi-Annual Channel. Or, if the device is updating from the Semi-Annual Channel,
    a version for the device to move to and/or stay on until the policy is updated or the
    device reaches end of service can be specified. Note: If you set both policies, the
    version specified will take precedence and the deferrals will not be in effect. Please see
    the Windows Release Information page for OS version information.
    Pause Updates To prevent Feature Updates from being received on their scheduled
    time, you can temporarily pause Feature Updates. The pause will remain in effect for 35
    days from the specified start date or until the field is cleared (Quality Updates will still be
    offered).
    Note: If the "Allow Diagnostic Data" (formerly "Allow Telemetry") policy is set to 0, this
    policy will have no effect.
    Note #2: Starting with Windows 10 R1607, Microsoft introduced a new Windows
    Update (WU) client behavior called Dual Scan, with an eye to cloud-based update
    management. In some cases, this Dual Scan feature can interfere with Windows
    Updates from Windows Server Update Services (WSUS) and/or manual WU updates. If
    you are using WSUS in your environment, you may need to set the above setting to Not
    Configured or configure the setting Do not allow update deferral policies to cause
    scans against Windows Update (added in the Windows 10 Release 1709 Administrative
    Templates) in order to prevent the Dual Scan feature from interfering. More information
    on Dual Scan is available at these links:
    •
    •

    Demystifying “Dual Scan” – WSUS Product Team Blog
    Improving Dual Scan on 1607 – WSUS Product Team Blog

    Note #3: Prior to Windows 10 R1703, values above 180 days are not recognized by the
    OS. Starting with Windows 10 R1703, the maximum number of days you can defer is
    365 days.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled: 180 or more days.
    Windows Update for Business\Defer Feature Updates Period in Days
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\DeferFeatureUpdatesPeriodInDays' AND data = '180';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Defer Quality Updates Period (Days)'' is set to ''Enabled: 0 days'''
  description: |-
    This policy settings controls when Quality Updates are received.
    The recommended state for this setting is: Enabled: 0 days.
    Note: If the "Allow Telemetry" policy is set to 0, this policy will have no effect.
    Note #2: Starting with Windows 10 R1607, Microsoft introduced a new Windows
    Update (WU) client behavior called Dual Scan, with an eye to cloud-based update
    management. In some cases, this Dual Scan feature can interfere with Windows
    Updates from Windows Server Update Services (WSUS) and/or manual WU updates. If
    you are using WSUS in your environment, you may need to set the above setting to Not
    Configured or configure the setting Do not allow update deferral policies to cause
    scans against Windows Update (added in the Windows 10 Release 1709 Administrative
    Templates) in order to prevent the Dual Scan feature from interfering. More information
    on Dual Scan is available at these links:
    •
    •

    Demystifying “Dual Scan” – WSUS Product Team Blog
    Improving Dual Scan on 1607 – WSUS Product Team Blog
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled:0 days.
    Windows Update for Business\Defer Quality Updates Period (Days)
  query: SELECT 1 FROM services WHERE name = 'Days' AND start_type != 'DISABLED';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Manage preview builds' is set to 'Disable Preview builds'
  description: This policy setting manage which updates that are receive prior to the update being released.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to 'Disabled':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Windows Update\Manage updates offered from Windows Update\Manage preview builds'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\ManagePreviewBuildsPolicyValue' AND data = 1);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Scheduled Install Day' is set to 'Every day'
  description: |-
    This policy setting specifies when computers in your environment will receive security
    updates from Windows Update or WSUS.
    The recommended state for this setting is: Every day.
    Note: This setting is only applicable if the option of 3 or 4 is selected in the
    recommendation 'Allow Auto Update'. It will have no impact if any other option is
    selected.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Every day.
    Windows Update For Business\Scheduled Install Day
  query: |-
    SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\\NoAutoUpdate' AND data = 0)
    AND EXISTS (
      SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\\ScheduledInstallDay' AND data = 0)
    );
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Block "Pause Updates" ability' is set to 'Block'
  description: |-
    This policy removes access to "Pause updates" feature.
    The recommended state for this setting is: Block.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Block:
    Windows Update For Business\Block "Pause Updates" ability
  query: SELECT 1 FROM registry WHERE path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\SetDisablePauseUXAccess' AND data = '1';
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Require PIN For Pairing'' is set to ''Enabled: Pairing ceremony for new devices will always require a PIN'' OR ''All pairings will require PIN'''
  description: |-
    This policy setting controls whether or not a PIN is required for pairing to a wireless
    display device.
    The recommended state for this setting is: Enabled: Pairing ceremony for new
    devices will always require a PIN' OR All pairings will require PIN.
  resolution: |-
    To establish the recommended configuration via configuration profiles, set the following
    Settings Catalog path to Enabled: Pairing ceremony for new devices will
    always require a PIN' OR All pairings will require PIN.
    Administrative Templates\Network\Wireless Display\Require pin pairing
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Connect\\RequirePinForPairing' AND data = 2);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Backup Directory' is set to 'Backup the password to Azure AD only'
  description: |-
    This policy setting configures which directory Windows LAPS will use to back up the
    local admin account password.
    The recommended state for this setting is: Backup the password to Azure AD only.
    Note: Organizations that utilize third-party commercial software to manage unique &
    complex local Administrator passwords on domain members may opt to disregard these
    LAPS recommendations.
    •
    •
    •

    Windows LAPS does not support standalone computers - they must be joined to
    an Active Directory domain or Entra ID (formerly Azure Active Directory).
    Windows LAPS does not support simultaneous storage of the local admin
    password in both directory types.
    If the setting is configured and the managed device is not joined to the configured
    directory type, the local administrator password will not be managed by Windows
    LAPS.

    Important: An organization wishing to use Active Directory to backup the LAPS
    password may make an exception for this recommendation. To implement Active
    Directory backup see the latest on-premises CIS Benchmark for Windows 10/11. When
    backing up with Active Directory there are 2 additional security controls to be
    considered in the benchmark which are not available when using Azure AD for backup.
    These were excluded from the Intune benchmark as they cannot be selected unless
    Active Directory is selected as the backup location.
  resolution: |-
    To establish the recommended configuration from Microsoft Intune Admin Center:
    1. Navigate to Endpoint security > Account protection.
    2. Create or edit a LAPS policy of the type Local admin password solution
    (Windows LAPS).
    3. Set Backup Directory to Backup the password to Azure AD only.
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\LAPS\\BackupDirectory' AND data in (1, 2));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Password Age Days'' is set to ''Configured: 30 or fewer'''
  description: |-
    This policy setting configures the Windows LAPS Password Settings policy for
    password age.
    Because attackers can crack passwords, the more frequently the password is changed
    the less opportunity an attacker has to use a cracked password.
    The recommended state for this setting is: Configured: 30 or fewer.
    Note: Organizations that utilize third-party commercial software to manage unique &
    complex local Administrator passwords on domain members may opt to disregard these
    LAPS recommendations.
    Note #2: Windows LAPS does not support standalone computers - they must be joined
    to an Active Directory domain or Entra ID (formerly Azure Active Directory).
  resolution: |-
    To establish the recommended configuration from Microsoft Intune Admin Center:
    1. Navigate to Endpoint security > Account protection.
    2. Create or edit a LAPS policy type Local admin password solution (Windows
    LAPS).
    3. Set Password Age Days to Configured: 30 (or fewer)
  query: SELECT 1 FROM registry where path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft Services\\AdmPwd\\PasswordAgeDays'  AND data <= 30;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Password Complexity' is set to 'Large letters + small letters + numbers + special characters'
  description: |-
    In May 2015, Microsoft released the Local Administrator Password Solution (LAPS) tool, which is free and supported software that allows an organization to automatically set randomized and unique local Administrator account passwords on domain-attached workstations and Member Servers. The passwords are stored in a confidential attribute of the domain computer account and can be retrieved from Active Directory by approved Sysadmins when needed.
    The LAPS tool requires a small Active Directory Schema update in order to implement, as well as installation of a Group Policy Client Side Extension (CSE) on targeted computers. Please see the LAPS documentation for details.
    LAPS supports Windows Vista or newer workstation OSes, and Server 2003 or newer server OSes. LAPS does not support standalone computers - they must be joined to a domain.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled, and configure the Password Complexity option to Large letters + small letters + numbers + special characters:
    'Computer Configuration\Policies\Administrative Templates\LAPS\Password Settings'
  query: SELECT 1 FROM registry where path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\Microsoft Services\\AdmPwd\\PasswordComplexity' AND data = 4;
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Password Length'' is set to ''Configured: 15 or more'''
  description: |-
    This policy setting configures the Windows LAPS Password Settings policy for
    password length.
    Each additional character in a password increases its complexity exponentially. For
    instance, a seven-character, all lower-case alphabetic password would have 26 to the
    power of 7 (approximately 8 x 10 to the power of 9 or 8 billion) possible combinations.
    At 1,000,000 attempts per second (a capability of many password-cracking utilities), it
    would only take 133 minutes to crack. A seven-character alphabetic password with case
    sensitivity has 52 to the power of 7 combinations. A seven-character case-sensitive
    alphanumeric password without punctuation has 627 combinations. An eight-character
    password has 26 to the power of 8 (or 2 x 10 to the power of 11) possible combinations.
    Although this might seem to be a large number, at 1,000,000 attempts per second it
    would take only 59 hours to try all possible passwords. Remember, these times will
    significantly increase for passwords that use ALT characters and other special keyboard
    characters such as "!" or "@". Proper use of the password settings can help make it
    difficult to mount a brute force attack.
    The recommended state for this setting is: Configured: 15 or more.
    Note: Organizations that utilize third-party commercial software to manage unique &
    complex local Administrator passwords on domain members may opt to disregard these
    LAPS recommendations.
    Note #2: Windows LAPS does not support standalone computers - they must be joined
    to an Active Directory domain or Entra ID (formerly Azure Active Directory).
  resolution: |-
    To establish the recommended configuration from Microsoft Intune Admin Center:
    1. Navigate to Endpoint security > Account protection.
    2. Create or edit a LAPS policy type Local admin password solution (Windows
    LAPS).
    3. Set Password Length to Configured: 15 (or more).
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SAM\\RelaxMinimumPasswordLengthLimits' AND data != 0);
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: CIS - Ensure 'Post-authentication actions' is set to 'Reset the password and logoff the managed account' or higher
  description: |-
    This policy settings configures post-authentication actions which will be executed after detecting an authentication by the LAPS managed account. The Action refers to actions to take upon expiry of the grace period before executing the specified post- authentication actions.
    Post-authentication actions:
    • Reset password: upon expiry of the grace period, the managed account password will be reset.
    • Reset the password and logoff the managed account: upon expiry of the grace period, the managed account password will be reset and any interactive logon sessions using the managed account will terminated.
    • Reset the password and reboot the device: upon expiry of the grace period, the managed account password will be reset and the managed device will be immediately rebooted.
  resolution: |-
    To establish the recommended configuration via GP, set the following UI path to Enabled: Reset the password and logoff the managed account or higher:
    'Computer Configuration\Policies\Administrative Templates\System\LAPS\Post- authentication actions: Actions'
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\LAPS\PostAuthenticationActions' AND data in (3,5));
  platform: windows
  critical: false
  calendar_events_enabled: false
- name: 'CIS - Ensure ''Post Authentication Reset Delay'' is set to ''Configured: 8 or fewer hours, but not 0'''
  description: |-
    This policy settings configures post-authentication actions which will be executed after
    detecting an authentication by the Windows LAPS managed account. The Grace
    period refers to the amount of time (hours) to wait after an authentication before
    executing the specified post-authentication actions.
    The recommended state for this setting is: Configured: 8 or fewer hours, but
    not 0.
    Note: Organizations that utilize third-party commercial software to manage unique &
    complex local Administrator passwords on domain members may opt to disregard these
    LAPS recommendations.
    Note #2: Windows LAPS does not support standalone computers - they must be joined
    to an Active Directory domain or Entra ID (formerly Azure Active Directory).
    Note #3: If this policy is set to 0 it prevents all post-authentication actions from
    occurring.
  resolution: |-
    To establish the recommended configuration from Microsoft Intune Admin Center:
    1. Navigate to Endpoint security > Account protection.
    2. Create or edit a LAPS policy type Local admin password solution (Windows
    LAPS).
    3. Set Post Authentication Reset Delay to Configured: 8 (or fewer
    hours, but not 0).
  query: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Policies\\LAPS\\PostAuthenticationResetDelay' AND cast(data as integer) BETWEEN 1 AND 8);
  platform: windows
  critical: false
  calendar_events_enabled: false
